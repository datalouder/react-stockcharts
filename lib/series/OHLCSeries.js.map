{"version":3,"sources":["../../../src/lib/series/OHLCSeries.js"],"names":["OHLCSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","yAccessor","xAccessor","xScale","yScale","chartConfig","plotData","barData","getOHLCBars","clip","getAxisCanvas","className","strokeWidth","bars","map","d","idx","stroke","openX1","openY","openX2","x","y1","y2","closeX1","closeY","closeX2","Component","propTypes","PropTypes","string","classNames","oneOfType","func","isRequired","bool","defaultProps","open","high","low","close","absoluteChange","wickNest","key","entries","lineWidth","forEach","outer","values","strokeStyle","beginPath","moveTo","lineTo","classNamesProp","strokeProp","strokeFunc","classNameFunc","width","length","barWidth","Math","max","round","min","filter","ohlc"],"mappings":"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","file":"OHLCSeries.js","sourcesContent":["import { nest } from 'd3-collection';\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport GenericChartComponent from '../GenericChartComponent';\nimport { getAxisCanvas } from '../GenericComponent';\n\nimport { isDefined, functor } from '../utils';\n\nclass OHLCSeries extends Component {\n  constructor(props) {\n    super(props);\n    this.renderSVG = this.renderSVG.bind(this);\n    this.drawOnCanvas = this.drawOnCanvas.bind(this);\n  }\n  drawOnCanvas(ctx, moreProps) {\n    const { yAccessor } = this.props;\n    const { xAccessor } = moreProps;\n    const {\n      xScale,\n      chartConfig: { yScale },\n      plotData,\n    } = moreProps;\n\n    const barData = getOHLCBars(\n      this.props,\n      xAccessor,\n      yAccessor,\n      xScale,\n      yScale,\n      plotData\n    );\n    drawOnCanvas(ctx, barData);\n  }\n  render() {\n    const { clip } = this.props;\n\n    return (\n      <GenericChartComponent\n        svgDraw={this.renderSVG}\n        canvasToDraw={getAxisCanvas}\n        canvasDraw={this.drawOnCanvas}\n        clip={clip}\n        drawOn={['pan']}\n      />\n    );\n  }\n  renderSVG(moreProps) {\n    const { className, yAccessor } = this.props;\n    const { xAccessor } = moreProps;\n    const {\n      xScale,\n      chartConfig: { yScale },\n      plotData,\n    } = moreProps;\n\n    const barData = getOHLCBars(\n      this.props,\n      xAccessor,\n      yAccessor,\n      xScale,\n      yScale,\n      plotData\n    );\n\n    const { strokeWidth, bars } = barData;\n\n    return (\n      <g className={className}>\n        {bars.map((d, idx) => (\n          <path\n            key={idx}\n            className={d.className}\n            stroke={d.stroke}\n            strokeWidth={strokeWidth}\n            d={`M${d.openX1} ${d.openY} L${d.openX2} ${d.openY} M${d.x} ${d.y1} L${d.x} ${d.y2} M${d.closeX1} ${d.closeY} L${d.closeX2} ${d.closeY}`}\n          />\n        ))}\n      </g>\n    );\n  }\n}\n\nOHLCSeries.propTypes = {\n  className: PropTypes.string,\n  classNames: PropTypes.oneOfType([PropTypes.func, PropTypes.string])\n    .isRequired,\n  stroke: PropTypes.oneOfType([PropTypes.func, PropTypes.string]).isRequired,\n  yAccessor: PropTypes.func.isRequired,\n  clip: PropTypes.bool.isRequired,\n};\n\nOHLCSeries.defaultProps = {\n  className: 'react-stockcharts-ohlc',\n  yAccessor: d => ({ open: d.open, high: d.high, low: d.low, close: d.close }),\n  classNames: d =>\n    isDefined(d.absoluteChange)\n      ? d.absoluteChange > 0\n        ? 'up'\n        : 'down'\n      : 'firstbar',\n  stroke: d =>\n    isDefined(d.absoluteChange)\n      ? d.absoluteChange > 0\n        ? '#6BA583'\n        : '#FF0000'\n      : '#000000',\n  clip: true,\n};\n\nfunction drawOnCanvas(ctx, barData) {\n  const { strokeWidth, bars } = barData;\n\n  const wickNest = nest()\n    .key(d => d.stroke)\n    .entries(bars);\n\n  ctx.lineWidth = strokeWidth;\n\n  wickNest.forEach(outer => {\n    const { key, values } = outer;\n    ctx.strokeStyle = key;\n    values.forEach(d => {\n      ctx.beginPath();\n      ctx.moveTo(d.x, d.y1);\n      ctx.lineTo(d.x, d.y2);\n\n      ctx.moveTo(d.openX1, d.openY);\n      ctx.lineTo(d.openX2, d.openY);\n\n      ctx.moveTo(d.closeX1, d.closeY);\n      ctx.lineTo(d.closeX2, d.closeY);\n\n      ctx.stroke();\n    });\n  });\n}\n\nfunction getOHLCBars(props, xAccessor, yAccessor, xScale, yScale, plotData) {\n  const { classNames: classNamesProp, stroke: strokeProp } = props;\n\n  const strokeFunc = functor(strokeProp);\n  const classNameFunc = functor(classNamesProp);\n\n  const width =\n    xScale(xAccessor(plotData[plotData.length - 1])) -\n    xScale(xAccessor(plotData[0]));\n\n  const barWidth = Math.max(\n    1,\n    Math.round(width / (plotData.length - 1) / 2) - 1.5\n  );\n  const strokeWidth = Math.min(barWidth, 6);\n\n  const bars = plotData\n    .filter(d => isDefined(yAccessor(d).close))\n    .map(d => {\n      const ohlc = yAccessor(d),\n        x = Math.round(xScale(xAccessor(d))),\n        y1 = yScale(ohlc.high),\n        y2 = yScale(ohlc.low),\n        openX1 = x - barWidth,\n        openX2 = x + strokeWidth / 2,\n        openY = yScale(ohlc.open),\n        closeX1 = x - strokeWidth / 2,\n        closeX2 = x + barWidth,\n        closeY = yScale(ohlc.close),\n        className = classNameFunc(d),\n        stroke = strokeFunc(d);\n\n      return {\n        x,\n        y1,\n        y2,\n        openX1,\n        openX2,\n        openY,\n        closeX1,\n        closeX2,\n        closeY,\n        stroke,\n        className,\n      };\n    });\n  return { barWidth, strokeWidth, bars };\n}\n\nexport default OHLCSeries;\n"]}
{"version":3,"sources":["../../../src/lib/series/TriangleMarker.js"],"names":["Triangle","props","className","strokeWidth","opacity","point","width","rotation","getRotationInDegrees","fillColor","getFillColor","strokeColor","getStrokeColor","w","datum","x","y","getTrianglePoints","innerOpposite","innerHypotenuse","points","propTypes","direction","PropTypes","oneOfType","oneOf","func","isRequired","stroke","string","fill","number","shape","object","defaultProps","drawOnCanvas","ctx","strokeStyle","lineWidth","fillStyle","drawOnCanvasWithNoStateChange","rotationDeg","beginPath","moveTo","lineTo","save","translate","rotate","Math","PI","restore","cos","tan","Function","directionVal"],"mappings":"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","file":"TriangleMarker.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { hexToRGBA, functor } from '../utils';\n\nfunction Triangle(props) {\n  const { className, strokeWidth, opacity, point, width } = props;\n\n  const rotation = getRotationInDegrees(props, point);\n  if (rotation == null) return null;\n\n  const fillColor = getFillColor(props);\n  const strokeColor = getStrokeColor(props);\n\n  const w = functor(width)(point.datum);\n  const { x, y } = point;\n  const { innerOpposite, innerHypotenuse } = getTrianglePoints(w);\n  const points = `\n\t\t${x} ${y - innerHypotenuse},\n\t\t${x + w / 2} ${y + innerOpposite},\n\t\t${x - w / 2} ${y + innerOpposite}\n\t`;\n\n  return (\n    <polygon\n      className={className}\n      points={points}\n      stroke={strokeColor}\n      strokeWidth={strokeWidth}\n      fillOpacity={opacity}\n      fill={fillColor}\n      transform={rotation !== 0 ? `rotate(${rotation}, ${x}, ${y})` : null}\n    />\n  );\n}\nTriangle.propTypes = {\n  direction: PropTypes.oneOfType([\n    PropTypes.oneOf(['top', 'bottom', 'left', 'right', 'hide']),\n    PropTypes.func,\n  ]).isRequired,\n  stroke: PropTypes.oneOfType([PropTypes.string, PropTypes.func]).isRequired,\n  fill: PropTypes.oneOfType([PropTypes.string, PropTypes.func]).isRequired,\n  opacity: PropTypes.number.isRequired,\n  point: PropTypes.shape({\n    x: PropTypes.number.isRequired,\n    y: PropTypes.number.isRequired,\n    datum: PropTypes.object.isRequired,\n  }).isRequired,\n  className: PropTypes.string,\n  strokeWidth: PropTypes.number,\n  width: PropTypes.oneOfType([PropTypes.number, PropTypes.func]).isRequired,\n};\nTriangle.defaultProps = {\n  direction: 'top',\n  stroke: '#4682B4',\n  strokeWidth: 1,\n  opacity: 0.5,\n  fill: '#4682B4',\n  className: 'react-stockcharts-marker-triangle',\n};\nTriangle.drawOnCanvas = (props, point, ctx) => {\n  const { stroke, fill, opacity, strokeWidth } = props;\n  ctx.strokeStyle = stroke;\n  ctx.lineWidth = strokeWidth;\n  if (fill !== 'none') {\n    ctx.fillStyle = hexToRGBA(fill, opacity);\n  }\n  Triangle.drawOnCanvasWithNoStateChange(props, point, ctx);\n};\nTriangle.drawOnCanvasWithNoStateChange = (props, point, ctx) => {\n  const { width } = props;\n  const w = functor(width)(point.datum);\n  const { x, y } = point;\n  const { innerOpposite, innerHypotenuse } = getTrianglePoints(w);\n  const rotationDeg = getRotationInDegrees(props, point);\n\n  ctx.beginPath();\n  ctx.moveTo(x, y - innerHypotenuse);\n  ctx.lineTo(x + w / 2, y + innerOpposite);\n  ctx.lineTo(x - w / 2, y + innerOpposite);\n  ctx.stroke();\n\n  // TODO: rotation does not work\n  // example: https://gist.github.com/geoffb/6392450\n  if (rotationDeg !== null && rotationDeg !== 0) {\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate((rotationDeg * Math.PI) / 180); // 45 degrees\n    ctx.fill();\n    ctx.restore();\n  }\n  ctx.fill();\n};\nexport default Triangle;\n\nfunction getTrianglePoints(width) {\n  const innerHypotenuse = (width / 2) * (1 / Math.cos((30 * Math.PI) / 180));\n  const innerOpposite = (width / 2) * (1 / Math.tan((60 * Math.PI) / 180));\n  return {\n    innerOpposite,\n    innerHypotenuse,\n  };\n}\n\nfunction getFillColor(props) {\n  const { fill, point } = props;\n  return fill instanceof Function ? fill(point.datum) : fill;\n}\n\nfunction getStrokeColor(props) {\n  const { stroke, point } = props;\n  return stroke instanceof Function ? stroke(point.datum) : stroke;\n}\n\nfunction getRotationInDegrees(props, point) {\n  const { direction } = props;\n  const directionVal =\n    direction instanceof Function ? direction(point.datum) : direction;\n  if (directionVal === 'hide') return null;\n\n  let rotate = 0;\n  switch (directionVal) {\n    case 'bottom':\n      rotate = 180;\n      break;\n    case 'left':\n      rotate = -90;\n      break;\n    case 'right':\n      rotate = 90;\n      break;\n  }\n  return rotate;\n}\n"]}
{"version":3,"sources":["../../../src/lib/series/OverlayBarSeries.js"],"names":["OverlayBarSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","yAccessor","bars","getBars","clip","getAxisCanvas","Component","propTypes","baseAt","PropTypes","oneOfType","number","func","isRequired","direction","oneOf","stroke","bool","widthRatio","opacity","fill","string","className","xAccessor","arrayOf","xScale","yScale","plotData","array","defaultProps","range","width","plotDataLengthBarWidth","chartConfig","getClassName","getFill","getBase","widthFunctor","offset","Math","floor","map","innerBars","eachYAccessor","i","yValue","d","undefined","xValue","x","round","y","filter","b","h","length","height"],"mappings":"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","file":"OverlayBarSeries.js","sourcesContent":["import { merge } from 'd3-array';\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport GenericChartComponent from '../GenericChartComponent';\nimport { getAxisCanvas } from '../GenericComponent';\n\nimport { drawOnCanvas2, getBarsSVG2 } from './StackedBarSeries';\nimport {\n  isDefined,\n  isNotDefined,\n  first,\n  functor,\n  plotDataLengthBarWidth,\n} from '../utils';\n\nclass OverlayBarSeries extends Component {\n  constructor(props) {\n    super(props);\n    this.renderSVG = this.renderSVG.bind(this);\n    this.drawOnCanvas = this.drawOnCanvas.bind(this);\n  }\n  drawOnCanvas(ctx, moreProps) {\n    const { yAccessor } = this.props;\n    const bars = getBars(this.props, moreProps, yAccessor);\n\n    drawOnCanvas2(this.props, ctx, bars);\n  }\n  renderSVG(moreProps) {\n    const { yAccessor } = this.props;\n\n    const bars = getBars(this.props, moreProps, yAccessor);\n    return (\n      <g className=\"react-stockcharts-bar-series\">\n        {getBarsSVG2(this.props, bars)}\n      </g>\n    );\n  }\n  render() {\n    const { clip } = this.props;\n\n    return (\n      <GenericChartComponent\n        svgDraw={this.renderSVG}\n        canvasToDraw={getAxisCanvas}\n        canvasDraw={this.drawOnCanvas}\n        clip={clip}\n        drawOn={['pan']}\n      />\n    );\n  }\n}\n\nOverlayBarSeries.propTypes = {\n  baseAt: PropTypes.oneOfType([PropTypes.number, PropTypes.func]).isRequired,\n  direction: PropTypes.oneOf(['up', 'down']).isRequired,\n  stroke: PropTypes.bool.isRequired,\n  widthRatio: PropTypes.number.isRequired,\n  opacity: PropTypes.number.isRequired,\n  fill: PropTypes.oneOfType([PropTypes.func, PropTypes.string]).isRequired,\n  className: PropTypes.oneOfType([PropTypes.func, PropTypes.string]).isRequired,\n  xAccessor: PropTypes.func,\n  yAccessor: PropTypes.arrayOf(PropTypes.func),\n  xScale: PropTypes.func,\n  yScale: PropTypes.func,\n  plotData: PropTypes.array,\n  clip: PropTypes.bool.isRequired,\n};\n\nOverlayBarSeries.defaultProps = {\n  baseAt: (xScale, yScale /* , d*/) => first(yScale.range()),\n  direction: 'up',\n  className: 'bar',\n  stroke: false,\n  fill: '#4682B4',\n  opacity: 1,\n  widthRatio: 0.5,\n  width: plotDataLengthBarWidth,\n  clip: true,\n};\n\nfunction getBars(props, moreProps, yAccessor) {\n  const {\n    xScale,\n    xAccessor,\n    chartConfig: { yScale },\n    plotData,\n  } = moreProps;\n  const { baseAt, className, fill, stroke } = props;\n\n  const getClassName = functor(className);\n  const getFill = functor(fill);\n  const getBase = functor(baseAt);\n  const widthFunctor = functor(props.width);\n\n  const width = widthFunctor(props, moreProps);\n  const offset = Math.floor(0.5 * width);\n\n  // console.log(xScale.domain(), yScale.domain());\n\n  const bars = plotData.map(d => {\n    // eslint-disable-next-line prefer-const\n    let innerBars = yAccessor\n      .map((eachYAccessor, i) => {\n        const yValue = eachYAccessor(d);\n        if (isNotDefined(yValue)) return undefined;\n\n        const xValue = xAccessor(d);\n        const x = Math.round(xScale(xValue)) - offset;\n        const y = yScale(yValue);\n        // console.log(yValue, y, xValue, x)\n        return {\n          width: offset * 2,\n          x: x,\n          y: y,\n          className: getClassName(d, i),\n          stroke: stroke ? getFill(d, i) : 'none',\n          fill: getFill(d, i),\n          i,\n        };\n      })\n      .filter(yValue => isDefined(yValue));\n\n    let b = getBase(xScale, yScale, d);\n    let h;\n    for (let i = innerBars.length - 1; i >= 0; i--) {\n      h = b - innerBars[i].y;\n      if (h < 0) {\n        innerBars[i].y = b;\n        h = -1 * h;\n      }\n      innerBars[i].height = h;\n      b = innerBars[i].y;\n    }\n    return innerBars;\n  });\n\n  return merge(bars);\n}\n\nexport default OverlayBarSeries;\n"]}
{"version":3,"sources":["../../../src/lib/series/PointAndFigureSeries.js"],"names":["PointAndFigureSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","xAccessor","xScale","yScale","chartConfig","plotData","columns","getColumns","clip","getAxisCanvas","stroke","fill","strokeWidth","className","map","col","idx","offset","boxes","box","i","direction","up","open","columnWidth","close","down","boxHeight","Component","propTypes","PropTypes","string","number","isRequired","object","bool","defaultProps","lineWidth","forEach","offsetX","offsetY","fillStyle","strokeStyle","beginPath","moveTo","lineTo","x","y","rx","ry","ellipse","Math","PI","width","length","anyBox","j","abs","filter","d","xOffset"],"mappings":"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","file":"PointAndFigureSeries.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport GenericChartComponent from '../GenericChartComponent';\nimport { getAxisCanvas } from '../GenericComponent';\n\nimport { isDefined, isNotDefined } from '../utils';\n\nclass PointAndFigureSeries extends Component {\n  constructor(props) {\n    super(props);\n    this.renderSVG = this.renderSVG.bind(this);\n    this.drawOnCanvas = this.drawOnCanvas.bind(this);\n  }\n  drawOnCanvas(ctx, moreProps) {\n    const { xAccessor } = moreProps;\n    const {\n      xScale,\n      chartConfig: { yScale },\n      plotData,\n    } = moreProps;\n    const columns = getColumns(xScale, xAccessor, yScale, plotData);\n\n    drawOnCanvas(ctx, this.props, columns);\n  }\n  render() {\n    const { clip } = this.props;\n\n    return (\n      <GenericChartComponent\n        clip={clip}\n        svgDraw={this.renderSVG}\n        canvasDraw={this.drawOnCanvas}\n        canvasToDraw={getAxisCanvas}\n        drawOn={['pan']}\n      />\n    );\n  }\n  renderSVG(moreProps) {\n    const { xAccessor } = moreProps;\n    const {\n      xScale,\n      chartConfig: { yScale },\n      plotData,\n    } = moreProps;\n\n    const { stroke, fill, strokeWidth, className } = this.props;\n\n    const columns = getColumns(xScale, xAccessor, yScale, plotData);\n\n    return (\n      <g className={className}>\n        {columns.map((col, idx) => (\n          <g\n            key={idx}\n            className={col.className}\n            transform={`translate(${col.offset[0]}, ${col.offset[1]})`}\n          >\n            {col.boxes.map((box, i) => {\n              if (col.direction > 0) {\n                return (\n                  <g key={`${idx}-${i}`}>\n                    <line\n                      className=\"up\"\n                      strokeWidth={strokeWidth}\n                      stroke={stroke.up}\n                      fill={fill.up}\n                      x1={0}\n                      y1={box.open}\n                      x2={box.columnWidth}\n                      y2={box.close}\n                    />\n                    <line\n                      className=\"up\"\n                      strokeWidth={strokeWidth}\n                      stroke={stroke.up}\n                      fill={fill.up}\n                      x1={0}\n                      y1={box.close}\n                      x2={box.columnWidth}\n                      y2={box.open}\n                    />\n                  </g>\n                );\n              }\n              return (\n                <ellipse\n                  key={`${idx}-${i}`}\n                  className=\"down\"\n                  strokeWidth={strokeWidth}\n                  stroke={stroke.down}\n                  fill={fill.down}\n                  cx={box.columnWidth / 2}\n                  cy={(box.open + box.close) / 2}\n                  rx={box.columnWidth / 2}\n                  ry={box.boxHeight / 2}\n                />\n              );\n            })}\n          </g>\n        ))}\n      </g>\n    );\n  }\n}\n\nPointAndFigureSeries.propTypes = {\n  className: PropTypes.string,\n  strokeWidth: PropTypes.number.isRequired,\n  stroke: PropTypes.object.isRequired,\n  fill: PropTypes.object.isRequired,\n  clip: PropTypes.bool.isRequired,\n};\n\nPointAndFigureSeries.defaultProps = {\n  className: 'react-stockcharts-point-and-figure',\n  strokeWidth: 1,\n  stroke: {\n    up: '#6BA583',\n    down: '#FF0000',\n  },\n  fill: {\n    up: 'none',\n    down: 'none',\n  },\n  clip: true,\n};\n\nfunction drawOnCanvas(ctx, props, columns) {\n  const { stroke, fill, strokeWidth } = props;\n\n  ctx.lineWidth = strokeWidth;\n\n  columns.forEach(col => {\n    const [offsetX, offsetY] = col.offset;\n    col.boxes.forEach(box => {\n      if (col.direction > 0) {\n        ctx.fillStyle = fill.up;\n        ctx.strokeStyle = stroke.up;\n\n        ctx.beginPath();\n\n        ctx.moveTo(offsetX, offsetY + box.open);\n        ctx.lineTo(offsetX + box.columnWidth, offsetY + box.close);\n        ctx.moveTo(offsetX, offsetY + box.close);\n        ctx.lineTo(offsetX + box.columnWidth, offsetY + box.open);\n\n        ctx.stroke();\n      } else {\n        ctx.fillStyle = fill.down;\n        ctx.strokeStyle = stroke.down;\n\n        ctx.beginPath();\n\n        const [x, y] = [\n          offsetX + box.columnWidth / 2,\n          offsetY + box.open + box.boxHeight / 2,\n        ];\n        const [rx, ry] = [box.columnWidth / 2, box.boxHeight / 2];\n\n        ctx.ellipse(x, y, rx, ry, 0, 0, 2 * Math.PI);\n        ctx.stroke();\n      }\n    });\n  });\n\n  ctx.stroke();\n}\n\nfunction getColumns(xScale, xAccessor, yScale, plotData) {\n  const width =\n    xScale(xAccessor(plotData[plotData.length - 1])) -\n    xScale(xAccessor(plotData[0]));\n\n  const columnWidth = width / (plotData.length - 1);\n\n  let anyBox,\n    j = 0;\n  while (isNotDefined(anyBox)) {\n    if (isDefined(plotData[j].close)) {\n      anyBox = plotData[j].boxes[0];\n    } else {\n      break;\n    }\n    j++;\n  }\n\n  const boxHeight = Math.abs(yScale(anyBox.open) - yScale(anyBox.close));\n\n  const columns = plotData\n    .filter(d => isDefined(d.close))\n    .map(d => {\n      const boxes = d.boxes.map(box => ({\n        columnWidth: columnWidth,\n        boxHeight: boxHeight,\n        open: yScale(box.open),\n        close: yScale(box.close),\n      }));\n\n      const xOffset = xScale(xAccessor(d)) - columnWidth / 2;\n      return {\n        boxes: boxes,\n        direction: d.direction,\n        offset: [xOffset, 0],\n      };\n    });\n  return columns;\n}\n\nexport default PointAndFigureSeries;\n"]}
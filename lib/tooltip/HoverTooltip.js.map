{"version":3,"sources":["../../../src/lib/tooltip/HoverTooltip.js"],"names":["HoverTooltip","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","pointer","helper","height","context","bgFill","bgOpacity","backgroundShapeSVG","tooltipSVG","bgheight","bgwidth","x","y","content","centerX","pointWidth","bgSize","bgShape","width","Component","propTypes","chartId","PropTypes","oneOfType","number","string","yAccessor","func","isRequired","tooltipContent","origin","array","fontFamily","fontSize","contextTypes","margin","object","ratio","defaultProps","tooltipCanvas","fill","stroke","fontFill","opacity","backgroundShapeCanvas","PADDING","X","Y","tspans","startY","i","length","textY","push","label","value","fillStyle","strokeStyle","beginPath","rect","font","textAlign","fillText","measureText","originX","left","originY","top","save","setTransform","scale","translate","restore","calculateTooltipSize","canvas","document","createElement","getContext","str","map","reduce","res","size","sumSizes","String","sizes","Math","max","d","normalizeX","normalizeY","mouseXY","xAccessor","currentItem","xScale","chartConfig","xValue","round","findIndex","yValue","chartIndex","id","yScale","show","plotData","displayXAccessor","abs"],"mappings":"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","file":"HoverTooltip.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport GenericComponent from '../GenericComponent';\nimport { sum } from 'd3-array';\n\nimport { first, last, isNotDefined, isDefined, hexToRGBA } from '../utils';\n\nclass HoverTooltip extends Component {\n  constructor(props) {\n    super(props);\n    this.renderSVG = this.renderSVG.bind(this);\n    this.drawOnCanvas = this.drawOnCanvas.bind(this);\n  }\n  drawOnCanvas(ctx, moreProps) {\n    const pointer = helper(this.props, moreProps, ctx);\n    const { height } = moreProps;\n\n    if (isNotDefined(pointer)) return null;\n    drawOnCanvas(ctx, this.props, this.context, pointer, height, moreProps);\n  }\n  render() {\n    return (\n      <GenericComponent\n        svgDraw={this.renderSVG}\n        canvasDraw={this.drawOnCanvas}\n        drawOn={['mousemove', 'pan' /* , \"mouseleave\" */]}\n      />\n    );\n  }\n  renderSVG(moreProps) {\n    const pointer = helper(this.props, moreProps);\n\n    if (isNotDefined(pointer)) return null;\n\n    const { bgFill, bgOpacity, backgroundShapeSVG, tooltipSVG } = this.props;\n    const { bgheight, bgwidth } = this.props;\n    const { height } = moreProps;\n\n    const { x, y, content, centerX, pointWidth, bgSize } = pointer;\n\n    const bgShape =\n      isDefined(bgwidth) && isDefined(bgheight)\n        ? { width: bgwidth, height: bgheight }\n        : bgSize;\n\n    return (\n      <g>\n        <rect\n          x={centerX - pointWidth / 2}\n          y={0}\n          width={pointWidth}\n          height={height}\n          fill={bgFill}\n          opacity={bgOpacity}\n        />\n        <g\n          className=\"react-stockcharts-tooltip-content\"\n          transform={`translate(${x}, ${y})`}\n        >\n          {backgroundShapeSVG(this.props, bgShape)}\n          {tooltipSVG(this.props, content)}\n        </g>\n      </g>\n    );\n  }\n}\n\nHoverTooltip.propTypes = {\n  chartId: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  yAccessor: PropTypes.func,\n  tooltipSVG: PropTypes.func,\n  backgroundShapeSVG: PropTypes.func,\n  bgwidth: PropTypes.number,\n  bgheight: PropTypes.number,\n  bgFill: PropTypes.string.isRequired,\n  bgOpacity: PropTypes.number.isRequired,\n  tooltipContent: PropTypes.func.isRequired,\n  origin: PropTypes.oneOfType([PropTypes.array, PropTypes.func]).isRequired,\n  fontFamily: PropTypes.string,\n  fontSize: PropTypes.number,\n};\n\nHoverTooltip.contextTypes = {\n  margin: PropTypes.object.isRequired,\n  ratio: PropTypes.number.isRequired,\n};\n\nHoverTooltip.defaultProps = {\n  // bgwidth: 150,\n  // bgheight: 50,\n  tooltipSVG: tooltipSVG,\n  tooltipCanvas: tooltipCanvas,\n  origin: origin,\n  fill: '#D4E2FD',\n  bgFill: '#D4E2FD',\n  bgOpacity: 0.5,\n  stroke: '#9B9BFF',\n  fontFill: '#000000',\n  opacity: 0.8,\n  backgroundShapeSVG: backgroundShapeSVG,\n  backgroundShapeCanvas: backgroundShapeCanvas,\n  fontFamily: 'Helvetica Neue, Helvetica, Arial, sans-serif',\n  fontSize: 12,\n};\n\nconst PADDING = 5;\nconst X = 10;\nconst Y = 10;\n\n/* eslint-disable react/prop-types */\nfunction backgroundShapeSVG({ fill, stroke, opacity }, { height, width }) {\n  return (\n    <rect\n      height={height}\n      width={width}\n      fill={fill}\n      opacity={opacity}\n      stroke={stroke}\n    />\n  );\n}\n\nfunction tooltipSVG({ fontFamily, fontSize, fontFill }, content) {\n  const tspans = [];\n  const startY = Y + fontSize * 0.9;\n\n  for (let i = 0; i < content.y.length; i++) {\n    const y = content.y[i];\n    const textY = startY + fontSize * (i + 1);\n\n    tspans.push(\n      <tspan key={`L-${i}`} x={X} y={textY} fill={y.stroke}>\n        {y.label}\n      </tspan>\n    );\n    tspans.push(<tspan key={i}>: </tspan>);\n    tspans.push(<tspan key={`V-${i}`}>{y.value}</tspan>);\n  }\n  return (\n    <text fontFamily={fontFamily} fontSize={fontSize} fill={fontFill}>\n      <tspan x={X} y={startY}>\n        {content.x}\n      </tspan>\n      {tspans}\n    </text>\n  );\n}\n/* eslint-enable react/prop-types */\n\nfunction backgroundShapeCanvas(props, { width, height }, ctx) {\n  const { fill, stroke, opacity } = props;\n\n  ctx.fillStyle = hexToRGBA(fill, opacity);\n  ctx.strokeStyle = stroke;\n  ctx.beginPath();\n  ctx.rect(0, 0, width, height);\n  ctx.fill();\n  ctx.stroke();\n}\n\nfunction tooltipCanvas({ fontFamily, fontSize, fontFill }, content, ctx) {\n  const startY = Y + fontSize * 0.9;\n  ctx.font = `${fontSize}px ${fontFamily}`;\n  ctx.fillStyle = fontFill;\n  ctx.textAlign = 'left';\n  ctx.fillText(content.x, X, startY);\n\n  for (let i = 0; i < content.y.length; i++) {\n    const y = content.y[i];\n    const textY = startY + fontSize * (i + 1);\n    ctx.fillStyle = y.stroke || fontFill;\n    ctx.fillText(y.label, X, textY);\n\n    ctx.fillStyle = fontFill;\n    ctx.fillText(': ' + y.value, X + ctx.measureText(y.label).width, textY);\n  }\n}\n\nfunction drawOnCanvas(ctx, props, context, pointer, height) {\n  const { margin, ratio } = context;\n  const { bgFill, bgOpacity } = props;\n  const { backgroundShapeCanvas, tooltipCanvas } = props;\n\n  const originX = 0.5 * ratio + margin.left;\n  const originY = 0.5 * ratio + margin.top;\n\n  ctx.save();\n\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n  ctx.scale(ratio, ratio);\n\n  ctx.translate(originX, originY);\n\n  const { x, y, content, centerX, pointWidth, bgSize } = pointer;\n\n  ctx.fillStyle = hexToRGBA(bgFill, bgOpacity);\n  ctx.beginPath();\n  ctx.rect(centerX - pointWidth / 2, 0, pointWidth, height);\n  ctx.fill();\n\n  ctx.translate(x, y);\n  backgroundShapeCanvas(props, bgSize, ctx);\n  tooltipCanvas(props, content, ctx);\n\n  ctx.restore();\n}\n\nfunction calculateTooltipSize(\n  { fontFamily, fontSize, fontFill },\n  content,\n  ctx\n) {\n  if (isNotDefined(ctx)) {\n    const canvas = document.createElement('canvas');\n    ctx = canvas.getContext('2d');\n  }\n\n  ctx.font = `${fontSize}px ${fontFamily}`;\n  ctx.fillStyle = fontFill;\n  ctx.textAlign = 'left';\n\n  const measureText = str => ({\n    width: ctx.measureText(str).width,\n    height: fontSize,\n  });\n\n  const { width, height } = content.y\n    .map(({ label, value }) => measureText(`${label}: ${value}`))\n    // Sum all y and x sizes (begin with x label size)\n    .reduce((res, size) => sumSizes(res, size), measureText(String(content.x)));\n  return {\n    width: width + 2 * X,\n    height: height + 2 * Y,\n  };\n}\n\nfunction sumSizes(...sizes) {\n  return {\n    width: Math.max(...sizes.map(size => size.width)),\n    height: sum(sizes, d => d.height),\n  };\n}\n\nfunction normalizeX(x, bgSize, pointWidth, width) {\n  // return x - bgSize.width - pointWidth / 2 - PADDING * 2 < 0\n  return x < width / 2\n    ? x + pointWidth / 2 + PADDING\n    : x - bgSize.width - pointWidth / 2 - PADDING;\n}\n\nfunction normalizeY(y, bgSize) {\n  return y - bgSize.height <= 0 ? y + PADDING : y - bgSize.height - PADDING;\n}\n\nfunction origin(props, moreProps, bgSize, pointWidth) {\n  const { chartId, yAccessor } = props;\n  const { mouseXY, xAccessor, currentItem, xScale, chartConfig, width } =\n    moreProps;\n  let y = last(mouseXY);\n\n  const xValue = xAccessor(currentItem);\n  let x = Math.round(xScale(xValue));\n\n  if (\n    isDefined(chartId) &&\n    isDefined(yAccessor) &&\n    isDefined(chartConfig) &&\n    isDefined(chartConfig.findIndex)\n  ) {\n    const yValue = yAccessor(currentItem);\n    const chartIndex = chartConfig.findIndex(x => x.id === chartId);\n\n    y = Math.round(chartConfig[chartIndex].yScale(yValue));\n  }\n\n  x = normalizeX(x, bgSize, pointWidth, width);\n  y = normalizeY(y, bgSize);\n\n  return [x, y];\n}\n\nfunction helper(props, moreProps, ctx) {\n  const { show, xScale, currentItem, plotData } = moreProps;\n  const { origin, tooltipContent } = props;\n  const { xAccessor, displayXAccessor } = moreProps;\n\n  if (!show || isNotDefined(currentItem)) return;\n\n  const xValue = xAccessor(currentItem);\n\n  if (!show || isNotDefined(xValue)) return;\n\n  const content = tooltipContent({ currentItem, xAccessor: displayXAccessor });\n  const centerX = xScale(xValue);\n  const pointWidth =\n    Math.abs(\n      xScale(xAccessor(last(plotData))) - xScale(xAccessor(first(plotData)))\n    ) /\n    (plotData.length - 1);\n\n  const bgSize = calculateTooltipSize(props, content, ctx);\n\n  const [x, y] = origin(props, moreProps, bgSize, pointWidth);\n\n  return { x, y, content, centerX, pointWidth, bgSize };\n}\n\nexport default HoverTooltip;\n"]}
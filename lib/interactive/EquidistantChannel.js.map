{"version":3,"sources":["../../../src/lib/interactive/EquidistantChannel.js"],"names":["EquidistantChannel","props","handleStart","bind","handleEnd","handleDrawChannel","handleDragChannel","handleDragChannelComplete","terminate","saveNodeType","getSelectionState","nodes","state","index","newXYValue","setState","override","moreProps","channels","rest","newChannels","map","each","idx","selected","onComplete","xyValue","current","startXY","mouseMoved","dy","endXY","m","b","y","onStart","e","appearance","d","enabled","currentPositionRadius","currentPositionStroke","currentPositionOpacity","currentPositionStrokeWidth","hoverText","overrideIndex","tempChannel","eachAppearance","Component","propTypes","PropTypes","bool","isRequired","func","onSelect","string","number","object","array","shape","stroke","strokeOpacity","strokeWidth","fill","fillOpacity","edgeStroke","edgeFill","edgeFill2","edgeStrokeWidth","r","defaultProps","noop","HoverTextNearMouse","enable","bgHeight","bgWidth","text"],"mappings":";;;;;;;;;;AAAA;;;;AACA;;;;AAEA;;AACA;;AACA;;;;AACA;;AACA;;;;AACA;;;;;;;;;;;;;;;;IAEMA,kB;;;AACJ,8BAAYC,KAAZ,EAAmB;AAAA;;AAAA,wIACXA,KADW;;AAGjB,UAAKC,WAAL,GAAmB,MAAKA,WAAL,CAAiBC,IAAjB,OAAnB;AACA,UAAKC,SAAL,GAAiB,MAAKA,SAAL,CAAeD,IAAf,OAAjB;AACA,UAAKE,iBAAL,GAAyB,MAAKA,iBAAL,CAAuBF,IAAvB,OAAzB;AACA,UAAKG,iBAAL,GAAyB,MAAKA,iBAAL,CAAuBH,IAAvB,OAAzB;AACA,UAAKI,yBAAL,GAAiC,MAAKA,yBAAL,CAA+BJ,IAA/B,OAAjC;;AAEA,UAAKK,SAAL,GAAiBA,kBAAUL,IAAV,OAAjB;AACA,UAAKM,YAAL,GAAoBA,qBAAaN,IAAb,OAApB;;AAEA,UAAKO,iBAAL,GAAyB,uCAA0B,UAA1B,EAAsCP,IAAtC,OAAzB;;AAEA,UAAKQ,KAAL,GAAa,EAAb;AACA,UAAKC,KAAL,GAAa,EAAb;AAfiB;AAgBlB;;;;sCACiBC,K,EAAOC,U,EAAY;AACnC,WAAKC,QAAL,CAAc;AACZC;AACEH;AADF,WAEKC,UAFL;AADY,OAAd;AAMD;;;8CACyBG,S,EAAW;AAAA;;AAAA,UAC3BD,QAD2B,GACd,KAAKJ,KADS,CAC3BI,QAD2B;AAAA,UAE3BE,QAF2B,GAEd,KAAKjB,KAFS,CAE3BiB,QAF2B;;;AAInC,UAAI,sBAAUF,QAAV,CAAJ,EAAyB;AAAA,YACfH,KADe,GACIG,QADJ,CACfH,KADe;AAAA,YACLM,IADK,4BACIH,QADJ;;AAEvB,YAAMI,cAAcF,SAASG,GAAT,CAAa,UAACC,IAAD,EAAOC,GAAP;AAAA,iBAC/BA,QAAQV,KAAR,gBAAqBS,IAArB,EAA8BH,IAA9B,IAAoCK,UAAU,IAA9C,MAAuDF,IADxB;AAAA,SAAb,CAApB;AAGA,aAAKP,QAAL,CACE;AACEC,oBAAU;AADZ,SADF,EAIE,YAAM;AACJ,iBAAKf,KAAL,CAAWwB,UAAX,CAAsBL,WAAtB,EAAmCH,SAAnC;AACD,SANH;AAQD;AACF;;;sCACiBS,O,EAAS;AAAA,UACjBC,OADiB,GACL,KAAKf,KADA,CACjBe,OADiB;;;AAGzB,UAAI,sBAAUA,OAAV,KAAsB,sBAAUA,QAAQC,OAAlB,CAA1B,EAAsD;AACpD,aAAKC,UAAL,GAAkB,IAAlB;AACA,YAAI,yBAAaF,QAAQG,EAArB,CAAJ,EAA8B;AAC5B,eAAKf,QAAL,CAAc;AACZY,qBAAS;AACPC,uBAASD,QAAQC,OADV;AAEPG,qBAAOL;AAFA;AADG,WAAd;AAMD,SAPD,MAOO;AACL,cAAMM,IAAI,4BAASL,QAAQC,OAAjB,EAA0BD,QAAQI,KAAlC,CAAV;AACA,cAAME,IAAI,iCAAcD,CAAd,EAAiBL,QAAQI,KAAzB,CAAV;AACA,cAAMG,IAAIF,IAAIN,QAAQ,CAAR,CAAJ,GAAiBO,CAA3B;AACA,cAAMH,KAAKJ,QAAQ,CAAR,IAAaQ,CAAxB;;AAEA,eAAKnB,QAAL,CAAc;AACZY,kCACKA,OADL;AAEEG;AAFF;AADY,WAAd;AAMD;AACF;AACF;;;gCACWJ,O,EAAS;AAAA;;AAAA,UACXC,OADW,GACC,KAAKf,KADN,CACXe,OADW;;;AAGnB,UAAI,yBAAaA,OAAb,KAAyB,yBAAaA,QAAQC,OAArB,CAA7B,EAA4D;AAC1D,aAAKC,UAAL,GAAkB,KAAlB;AACA,aAAKd,QAAL,CACE;AACEY,mBAAS;AACPC,qBAASF,OADF;AAEPK,mBAAO;AAFA;AADX,SADF,EAOE,YAAM;AACJ,iBAAK9B,KAAL,CAAWkC,OAAX;AACD,SATH;AAWD;AACF;;;8BACST,O,EAAST,S,EAAWmB,C,EAAG;AAAA;;AAAA,UACvBT,OADuB,GACX,KAAKf,KADM,CACvBe,OADuB;AAAA,mBAEE,KAAK1B,KAFP;AAAA,UAEvBiB,QAFuB,UAEvBA,QAFuB;AAAA,UAEbmB,UAFa,UAEbA,UAFa;;;AAI/B,UAAI,KAAKR,UAAL,IAAmB,sBAAUF,OAAV,CAAnB,IAAyC,sBAAUA,QAAQC,OAAlB,CAA7C,EAAyE;AACvE,YAAI,yBAAaD,QAAQG,EAArB,CAAJ,EAA8B;AAC5B,eAAKf,QAAL,CAAc;AACZY,kCACKA,OADL;AAEEG,kBAAI;AAFN;AADY,WAAd;AAMD,SAPD,MAOO;AACL,cAAMV,2CACDF,SAASG,GAAT,CAAa;AAAA,gCAAWiB,CAAX,IAAcd,UAAU,KAAxB;AAAA,WAAb,CADC,iBAGCG,OAHD;AAIFH,sBAAU,IAJR;AAKFa;AALE,cAAN;;AASA,eAAKtB,QAAL,CACE;AACEY,qBAAS;AADX,WADF,EAIE,YAAM;AACJ,mBAAK1B,KAAL,CAAWwB,UAAX,CAAsBL,WAAtB,EAAmCH,SAAnC,EAA8CmB,CAA9C;AACD,WANH;AAQD;AACF;AACF;;;6BACQ;AAAA;;AAAA,UACCC,UADD,GACgB,KAAKpC,KADrB,CACCoC,UADD;AAAA,UAECE,OAFD,GAEa,KAAKtC,KAFlB,CAECsC,OAFD;AAAA,oBAGkD,KAAKtC,KAHvD;AAAA,UAGCuC,qBAHD,WAGCA,qBAHD;AAAA,UAGwBC,qBAHxB,WAGwBA,qBAHxB;AAAA,oBAIwD,KAAKxC,KAJ7D;AAAA,UAICyC,sBAJD,WAICA,sBAJD;AAAA,UAIyBC,0BAJzB,WAIyBA,0BAJzB;AAAA,oBAKyB,KAAK1C,KAL9B;AAAA,UAKCiB,QALD,WAKCA,QALD;AAAA,UAKW0B,SALX,WAKWA,SALX;AAAA,mBAMuB,KAAKhC,KAN5B;AAAA,UAMCe,OAND,UAMCA,OAND;AAAA,UAMUX,QANV,UAMUA,QANV;;AAOP,UAAM6B,gBAAgB,sBAAU7B,QAAV,IAAsBA,SAASH,KAA/B,GAAuC,IAA7D;;AAEA,UAAMiC,cACJ,sBAAUnB,OAAV,KAAsB,sBAAUA,QAAQI,KAAlB,CAAtB,GACE,8BAAC,gCAAD;AACE,qBAAa;AADf,SAEMJ,OAFN;AAGE,oBAAYU,UAHd;AAIE,mBAAWO;AAJb,SADF,GAOI,IARN;;AAUA,aACE;AAAA;AAAA;AACG1B,iBAASG,GAAT,CAAa,UAACC,IAAD,EAAOC,GAAP,EAAe;AAC3B,cAAMwB,iBAAiB,sBAAUzB,KAAKe,UAAf,iBACdA,UADc,EACCf,KAAKe,UADN,IAEnBA,UAFJ;;AAIA,iBACE,8BAAC,gCAAD;AACE,iBAAKd,GADP;AAEE,iBAAK,OAAKd,YAAL,CAAkBc,GAAlB,CAFP;AAGE,mBAAOA,GAHT;AAIE,sBAAUD,KAAKE,QAJjB;AAKE,uBAAWoB;AALb,aAMOrB,QAAQsB,aAAR,GAAwB7B,QAAxB,GAAmCM,IAN1C;AAOE,wBAAYyB,cAPd;AAQE,oBAAQ,OAAKzC,iBARf;AASE,4BAAgB,OAAKC;AATvB,aADF;AAaD,SAlBA,CADH;AAoBGuC,mBApBH;AAqBE,sCAAC,gCAAD;AACE,mBAASP,OADX;AAEE,gBAAM,KAFR;AAGE,aAAGC,qBAHL;AAIE,kBAAQC,qBAJV;AAKE,mBAASC,sBALX;AAME,uBAAaC,0BANf;AAOE,uBAAa,KAAKzC,WAPpB;AAQE,mBAAS,KAAKE,SARhB;AASE,uBAAa,KAAKC;AATpB;AArBF,OADF;AAmCD;;;;EAjL8B2C,gB;;AAoLjChD,mBAAmBiD,SAAnB,GAA+B;AAC7BV,WAASW,oBAAUC,IAAV,CAAeC,UADK;;AAG7BjB,WAASe,oBAAUG,IAAV,CAAeD,UAHK;AAI7B3B,cAAYyB,oBAAUG,IAAV,CAAeD,UAJE;AAK7BE,YAAUJ,oBAAUG,IAAV,CAAeD,UALI;;AAO7BX,yBAAuBS,oBAAUK,MAPJ;AAQ7BZ,8BAA4BO,oBAAUM,MART;AAS7Bd,0BAAwBQ,oBAAUM,MATL;AAU7BhB,yBAAuBU,oBAAUM,MAVJ;;AAY7BZ,aAAWM,oBAAUO,MAAV,CAAiBL,UAZC;AAa7BlC,YAAUgC,oBAAUQ,KAAV,CAAgBN,UAbG;;AAe7Bf,cAAYa,oBAAUS,KAAV,CAAgB;AAC1BC,YAAQV,oBAAUK,MAAV,CAAiBH,UADC;AAE1BS,mBAAeX,oBAAUM,MAAV,CAAiBJ,UAFN;AAG1BU,iBAAaZ,oBAAUM,MAAV,CAAiBJ,UAHJ;AAI1BW,UAAMb,oBAAUK,MAAV,CAAiBH,UAJG;AAK1BY,iBAAad,oBAAUM,MAAV,CAAiBJ,UALJ;AAM1Ba,gBAAYf,oBAAUK,MAAV,CAAiBH,UANH;AAO1Bc,cAAUhB,oBAAUK,MAAV,CAAiBH,UAPD;AAQ1Be,eAAWjB,oBAAUK,MAAV,CAAiBH,UARF;AAS1BgB,qBAAiBlB,oBAAUM,MAAV,CAAiBJ,UATR;AAU1BiB,OAAGnB,oBAAUM,MAAV,CAAiBJ;AAVM,GAAhB,EAWTA;AA1B0B,CAA/B;;AA6BApD,mBAAmBsE,YAAnB,GAAkC;AAChCnC,WAASoC,WADuB;AAEhC9C,cAAY8C,WAFoB;AAGhCjB,YAAUiB,WAHsB;;AAKhC9B,yBAAuB,SALS;AAMhCC,0BAAwB,CANQ;AAOhCC,8BAA4B,CAPI;AAQhCH,yBAAuB,CARS;;AAUhCI,0BACK4B,6BAAmBF,YADxB;AAEEG,YAAQ,IAFV;AAGEC,cAAU,EAHZ;AAIEC,aAAS,GAJX;AAKEC,UAAM;AALR,IAVgC;AAiBhC1D,YAAU,EAjBsB;AAkBhCmB,cAAY;AACVuB,YAAQ,SADE;AAEVC,mBAAe,CAFL;AAGVC,iBAAa,CAHH;AAIVC,UAAM,SAJI;AAKVC,iBAAa,GALH;AAMVC,gBAAY,SANF;AAOVC,cAAU,SAPA;AAQVC,eAAW,SARD;AASVC,qBAAiB,CATP;AAUVC,OAAG;AAVO;AAlBoB,CAAlC;;kBAgCerE,kB","file":"EquidistantChannel.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport { isDefined, isNotDefined, noop } from '../utils';\nimport { terminate, saveNodeType, isHoverForInteractiveType } from './utils';\nimport EachEquidistantChannel from './wrapper/EachEquidistantChannel';\nimport { getSlope, getYIntercept } from './components/StraightLine';\nimport MouseLocationIndicator from './components/MouseLocationIndicator';\nimport HoverTextNearMouse from './components/HoverTextNearMouse';\n\nclass EquidistantChannel extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleStart = this.handleStart.bind(this);\n    this.handleEnd = this.handleEnd.bind(this);\n    this.handleDrawChannel = this.handleDrawChannel.bind(this);\n    this.handleDragChannel = this.handleDragChannel.bind(this);\n    this.handleDragChannelComplete = this.handleDragChannelComplete.bind(this);\n\n    this.terminate = terminate.bind(this);\n    this.saveNodeType = saveNodeType.bind(this);\n\n    this.getSelectionState = isHoverForInteractiveType('channels').bind(this);\n\n    this.nodes = [];\n    this.state = {};\n  }\n  handleDragChannel(index, newXYValue) {\n    this.setState({\n      override: {\n        index,\n        ...newXYValue,\n      },\n    });\n  }\n  handleDragChannelComplete(moreProps) {\n    const { override } = this.state;\n    const { channels } = this.props;\n\n    if (isDefined(override)) {\n      const { index, ...rest } = override;\n      const newChannels = channels.map((each, idx) =>\n        idx === index ? { ...each, ...rest, selected: true } : each\n      );\n      this.setState(\n        {\n          override: null,\n        },\n        () => {\n          this.props.onComplete(newChannels, moreProps);\n        }\n      );\n    }\n  }\n  handleDrawChannel(xyValue) {\n    const { current } = this.state;\n\n    if (isDefined(current) && isDefined(current.startXY)) {\n      this.mouseMoved = true;\n      if (isNotDefined(current.dy)) {\n        this.setState({\n          current: {\n            startXY: current.startXY,\n            endXY: xyValue,\n          },\n        });\n      } else {\n        const m = getSlope(current.startXY, current.endXY);\n        const b = getYIntercept(m, current.endXY);\n        const y = m * xyValue[0] + b;\n        const dy = xyValue[1] - y;\n\n        this.setState({\n          current: {\n            ...current,\n            dy,\n          },\n        });\n      }\n    }\n  }\n  handleStart(xyValue) {\n    const { current } = this.state;\n\n    if (isNotDefined(current) || isNotDefined(current.startXY)) {\n      this.mouseMoved = false;\n      this.setState(\n        {\n          current: {\n            startXY: xyValue,\n            endXY: null,\n          },\n        },\n        () => {\n          this.props.onStart();\n        }\n      );\n    }\n  }\n  handleEnd(xyValue, moreProps, e) {\n    const { current } = this.state;\n    const { channels, appearance } = this.props;\n\n    if (this.mouseMoved && isDefined(current) && isDefined(current.startXY)) {\n      if (isNotDefined(current.dy)) {\n        this.setState({\n          current: {\n            ...current,\n            dy: 0,\n          },\n        });\n      } else {\n        const newChannels = [\n          ...channels.map(d => ({ ...d, selected: false })),\n          {\n            ...current,\n            selected: true,\n            appearance,\n          },\n        ];\n\n        this.setState(\n          {\n            current: null,\n          },\n          () => {\n            this.props.onComplete(newChannels, moreProps, e);\n          }\n        );\n      }\n    }\n  }\n  render() {\n    const { appearance } = this.props;\n    const { enabled } = this.props;\n    const { currentPositionRadius, currentPositionStroke } = this.props;\n    const { currentPositionOpacity, currentPositionStrokeWidth } = this.props;\n    const { channels, hoverText } = this.props;\n    const { current, override } = this.state;\n    const overrideIndex = isDefined(override) ? override.index : null;\n\n    const tempChannel =\n      isDefined(current) && isDefined(current.endXY) ? (\n        <EachEquidistantChannel\n          interactive={false}\n          {...current}\n          appearance={appearance}\n          hoverText={hoverText}\n        />\n      ) : null;\n\n    return (\n      <g>\n        {channels.map((each, idx) => {\n          const eachAppearance = isDefined(each.appearance)\n            ? { ...appearance, ...each.appearance }\n            : appearance;\n\n          return (\n            <EachEquidistantChannel\n              key={idx}\n              ref={this.saveNodeType(idx)}\n              index={idx}\n              selected={each.selected}\n              hoverText={hoverText}\n              {...(idx === overrideIndex ? override : each)}\n              appearance={eachAppearance}\n              onDrag={this.handleDragChannel}\n              onDragComplete={this.handleDragChannelComplete}\n            />\n          );\n        })}\n        {tempChannel}\n        <MouseLocationIndicator\n          enabled={enabled}\n          snap={false}\n          r={currentPositionRadius}\n          stroke={currentPositionStroke}\n          opacity={currentPositionOpacity}\n          strokeWidth={currentPositionStrokeWidth}\n          onMouseDown={this.handleStart}\n          onClick={this.handleEnd}\n          onMouseMove={this.handleDrawChannel}\n        />\n      </g>\n    );\n  }\n}\n\nEquidistantChannel.propTypes = {\n  enabled: PropTypes.bool.isRequired,\n\n  onStart: PropTypes.func.isRequired,\n  onComplete: PropTypes.func.isRequired,\n  onSelect: PropTypes.func.isRequired,\n\n  currentPositionStroke: PropTypes.string,\n  currentPositionStrokeWidth: PropTypes.number,\n  currentPositionOpacity: PropTypes.number,\n  currentPositionRadius: PropTypes.number,\n\n  hoverText: PropTypes.object.isRequired,\n  channels: PropTypes.array.isRequired,\n\n  appearance: PropTypes.shape({\n    stroke: PropTypes.string.isRequired,\n    strokeOpacity: PropTypes.number.isRequired,\n    strokeWidth: PropTypes.number.isRequired,\n    fill: PropTypes.string.isRequired,\n    fillOpacity: PropTypes.number.isRequired,\n    edgeStroke: PropTypes.string.isRequired,\n    edgeFill: PropTypes.string.isRequired,\n    edgeFill2: PropTypes.string.isRequired,\n    edgeStrokeWidth: PropTypes.number.isRequired,\n    r: PropTypes.number.isRequired,\n  }).isRequired,\n};\n\nEquidistantChannel.defaultProps = {\n  onStart: noop,\n  onComplete: noop,\n  onSelect: noop,\n\n  currentPositionStroke: '#000000',\n  currentPositionOpacity: 1,\n  currentPositionStrokeWidth: 3,\n  currentPositionRadius: 4,\n\n  hoverText: {\n    ...HoverTextNearMouse.defaultProps,\n    enable: true,\n    bgHeight: 18,\n    bgWidth: 120,\n    text: 'Click to select object',\n  },\n  channels: [],\n  appearance: {\n    stroke: '#000000',\n    strokeOpacity: 1,\n    strokeWidth: 1,\n    fill: '#8AAFE2',\n    fillOpacity: 0.7,\n    edgeStroke: '#000000',\n    edgeFill: '#FFFFFF',\n    edgeFill2: '#250B98',\n    edgeStrokeWidth: 1,\n    r: 5,\n  },\n};\n\nexport default EquidistantChannel;\n"]}
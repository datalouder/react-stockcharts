{"version":3,"sources":["../../../src/lib/annotation/Label.js"],"names":["Label","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","drawOnCanvas2","context","selectCanvas","chartConfig","getYScale","getText","Component","text","Array","isArray","undefined","yScale","propTypes","className","PropTypes","string","func","oneOfType","isRequired","textAnchor","fontFamily","fontSize","number","opacity","rotate","onClick","xAccessor","xScale","datum","object","x","y","contextTypes","canvasOriginX","canvasOriginY","margin","ratio","defaultProps","canvases","bg","save","setTransform","scale","translate","left","top","restore","xPos","yPos","fill","radians","Math","PI","font","fillStyle","textAlign","beginPath","fillText"],"mappings":"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","file":"Label.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport GenericComponent from '../GenericComponent';\n\nimport { isDefined, hexToRGBA, functor } from '../utils';\nimport LabelAnnotation, { defaultProps, helper } from './LabelAnnotation';\n\nclass Label extends Component {\n  constructor(props) {\n    super(props);\n    this.renderSVG = this.renderSVG.bind(this);\n    this.drawOnCanvas = this.drawOnCanvas.bind(this);\n  }\n  drawOnCanvas(ctx, moreProps) {\n    drawOnCanvas2(ctx, this.props, this.context, moreProps);\n  }\n  render() {\n    return (\n      <GenericComponent\n        canvasToDraw={this.props.selectCanvas}\n        svgDraw={this.renderSVG}\n        canvasDraw={this.drawOnCanvas}\n        drawOn={[]}\n      />\n    );\n  }\n  renderSVG(moreProps) {\n    const { chartConfig } = moreProps;\n\n    return (\n      <LabelAnnotation\n        yScale={getYScale(chartConfig)}\n        {...this.props}\n        text={getText(this.props)}\n      />\n    );\n  }\n}\n\nfunction getText(props) {\n  return functor(props.text)(props);\n}\n\nfunction getYScale(chartConfig) {\n  return Array.isArray(chartConfig) ? undefined : chartConfig.yScale;\n}\n\nLabel.propTypes = {\n  className: PropTypes.string,\n  selectCanvas: PropTypes.func,\n  text: PropTypes.oneOfType([PropTypes.string, PropTypes.func]).isRequired,\n  textAnchor: PropTypes.string,\n  fontFamily: PropTypes.string,\n  fontSize: PropTypes.number,\n  opacity: PropTypes.number,\n  rotate: PropTypes.number,\n  onClick: PropTypes.func,\n  xAccessor: PropTypes.func,\n  xScale: PropTypes.func,\n  yScale: PropTypes.func,\n  datum: PropTypes.object,\n  x: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  y: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n};\n\nLabel.contextTypes = {\n  canvasOriginX: PropTypes.number,\n  canvasOriginY: PropTypes.number,\n\n  margin: PropTypes.object.isRequired,\n  ratio: PropTypes.number.isRequired,\n};\n\nLabel.defaultProps = {\n  ...defaultProps,\n  selectCanvas: canvases => canvases.bg,\n};\n\nfunction drawOnCanvas2(ctx, props, context, moreProps) {\n  ctx.save();\n\n  const { canvasOriginX, canvasOriginY, margin, ratio } = context;\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n  ctx.scale(ratio, ratio);\n\n  if (isDefined(canvasOriginX)) ctx.translate(canvasOriginX, canvasOriginY);\n  else ctx.translate(margin.left + 0.5 * ratio, margin.top + 0.5 * ratio);\n\n  drawOnCanvas(ctx, props, moreProps);\n\n  ctx.restore();\n}\n\nfunction drawOnCanvas(ctx, props, moreProps) {\n  const { textAnchor, fontFamily, fontSize, opacity, rotate } = props;\n  const { xScale, chartConfig, xAccessor } = moreProps;\n\n  const { xPos, yPos, fill, text } = helper(\n    props,\n    xAccessor,\n    xScale,\n    getYScale(chartConfig)\n  );\n\n  const radians = (rotate / 180) * Math.PI;\n  ctx.save();\n  ctx.translate(xPos, yPos);\n  ctx.rotate(radians);\n\n  ctx.font = `${fontSize}px ${fontFamily}`;\n  ctx.fillStyle = hexToRGBA(fill, opacity);\n  ctx.textAlign = textAnchor === 'middle' ? 'center' : textAnchor;\n\n  ctx.beginPath();\n  ctx.fillText(text, 0, 0);\n  ctx.restore();\n}\n\nexport default Label;\n"]}
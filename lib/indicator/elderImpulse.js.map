{"version":3,"sources":["../../../src/lib/indicator/elderImpulse.js"],"names":["macdSource","emaSource","base","type","ALGORITHM_TYPE","stroke","appearanceOptions","fill","undefined","underlyingAlgorithm","windowSize","undefinedValue","accumulator","prev","curr","Error","prevMACDDivergence","divergence","currMACDDivergence","prevEMA","currEMA","mergedAlgorithm","algorithm","merge","datum","indicator","elderImpulse","data","options","newData","x","arguments","length"],"mappings":";;;;;;;;kBAae,YAAY;AACzB,MAAIA,mBAAJ;AAAA,MAAgBC,kBAAhB;;AAEA,MAAMC,OAAO,+BACVC,IADU,CACLC,cADK;AAEX;AAFW,GAGVC,MAHU,CAGHC,0CAAkBD,MAHf,EAIVE,IAJU,CAILC,SAJK,CAAb;;AAMA,MAAMC,sBAAsB,4BACzBC,UADyB,CACd,CADc,EAEzBC,cAFyB,CAEV,SAFU,EAGzBC,WAHyB,CAGb,gBAAkB;AAAA;AAAA,QAAhBC,IAAgB;AAAA,QAAVC,IAAU;;AAC7B,QAAI,yBAAad,UAAb,CAAJ,EACE,MAAM,IAAIe,KAAJ,iCAC0BX,cAD1B,iBAAN;AAGF,QAAI,yBAAaH,SAAb,CAAJ,EACE,MAAM,IAAIc,KAAJ,gCACyBX,cADzB,iBAAN;;AAIF,QAAI,sBAAUJ,WAAWa,IAAX,CAAV,KAA+B,sBAAUZ,UAAUY,IAAV,CAAV,CAAnC,EAA+D;AAC7D,UAAMG,qBAAqBhB,WAAWa,IAAX,EAAiBI,UAA5C;AACA,UAAMC,qBAAqBlB,WAAWc,IAAX,EAAiBG,UAA5C;;AAEA,UAAME,UAAUlB,UAAUY,IAAV,CAAhB;AACA,UAAMO,UAAUnB,UAAUa,IAAV,CAAhB;;AAEA,UAAII,sBAAsBF,kBAAtB,IAA4CI,WAAWD,OAA3D,EACE,OAAO,IAAP;;AAEF,UAAID,sBAAsBF,kBAAtB,IAA4CI,WAAWD,OAA3D,EACE,OAAO,MAAP;AACH;AACD,WAAO,SAAP;AACD,GA3ByB,CAA5B;;AA6BA,MAAME,kBAAkB,oBACrBC,SADqB,CACXb,mBADW,EAErBc,KAFqB,CAEf,UAACC,KAAD,EAAQC,SAAR,EAAsB;AAC3BD,UAAME,YAAN,GAAqBD,SAArB;AACD,GAJqB,CAAxB;;AAMA;AACA,MAAIA,YAAY,SAAZA,SAAY,CAAUE,IAAV,EAA2C;AAAA,QAA3BC,OAA2B,uEAAjB,EAAEL,OAAO,IAAT,EAAiB;;AACzD,QAAMM,UAAUD,QAAQL,KAAR,GACZF,gBAAgBM,IAAhB,CADY,GAEZlB,oBAAoBkB,IAApB,CAFJ;;AAIA,WAAOE,OAAP;AACD,GAND;AAOAJ,YAAUzB,UAAV,GAAuB,UAAU8B,CAAV,EAAa;AAClC,QAAI,CAACC,UAAUC,MAAf,EAAuB,OAAOhC,UAAP;AACvBA,iBAAa8B,CAAb;AACA,WAAOL,SAAP;AACD,GAJD;AAKAA,YAAUxB,SAAV,GAAsB,UAAU6B,CAAV,EAAa;AACjC,QAAI,CAACC,UAAUC,MAAf,EAAuB,OAAO/B,SAAP;AACvBA,gBAAY6B,CAAZ;AACA,WAAOL,SAAP;AACD,GAJD;AAKA,qBAAOA,SAAP,EAAkBvB,IAAlB,EAAwB,IAAxB,EAA8B,MAA9B,EAAsC,MAAtC,EAA8C,QAA9C;AACA;AACA,qBAAOuB,SAAP,EAAkBJ,eAAlB,EAAmC,OAAnC,EAA4C,eAA5C;;AAEA,SAAOI,SAAP;AACD,C;;AAhFD;;AAQA;;AACA;;;;;;AAEA,IAAMrB,iBAAiB,cAAvB","file":"elderImpulse.js","sourcesContent":["import {\n  rebind,\n  isDefined,\n  isNotDefined,\n  merge,\n  slidingWindow,\n} from '../utils';\n\nimport { ElderImpulse as appearanceOptions } from './defaultOptionsForAppearance';\nimport baseIndicator from './baseIndicator';\n\nconst ALGORITHM_TYPE = 'ElderImpulse';\n\nexport default function () {\n  let macdSource, emaSource;\n\n  const base = baseIndicator()\n    .type(ALGORITHM_TYPE)\n    // .stroke(d => stroke[d.elderImpulse])\n    .stroke(appearanceOptions.stroke)\n    .fill(undefined);\n\n  const underlyingAlgorithm = slidingWindow()\n    .windowSize(2)\n    .undefinedValue('neutral')\n    .accumulator(([prev, curr]) => {\n      if (isNotDefined(macdSource))\n        throw new Error(\n          `macdSource not defined for ${ALGORITHM_TYPE} calculator`\n        );\n      if (isNotDefined(emaSource))\n        throw new Error(\n          `emaSource not defined for ${ALGORITHM_TYPE} calculator`\n        );\n\n      if (isDefined(macdSource(prev)) && isDefined(emaSource(prev))) {\n        const prevMACDDivergence = macdSource(prev).divergence;\n        const currMACDDivergence = macdSource(curr).divergence;\n\n        const prevEMA = emaSource(prev);\n        const currEMA = emaSource(curr);\n\n        if (currMACDDivergence >= prevMACDDivergence && currEMA >= prevEMA)\n          return 'up';\n\n        if (currMACDDivergence <= prevMACDDivergence && currEMA <= prevEMA)\n          return 'down';\n      }\n      return 'neutral';\n    });\n\n  const mergedAlgorithm = merge()\n    .algorithm(underlyingAlgorithm)\n    .merge((datum, indicator) => {\n      datum.elderImpulse = indicator;\n    });\n\n  // eslint-disable-next-line prefer-const\n  let indicator = function (data, options = { merge: true }) {\n    const newData = options.merge\n      ? mergedAlgorithm(data)\n      : underlyingAlgorithm(data);\n\n    return newData;\n  };\n  indicator.macdSource = function (x) {\n    if (!arguments.length) return macdSource;\n    macdSource = x;\n    return indicator;\n  };\n  indicator.emaSource = function (x) {\n    if (!arguments.length) return emaSource;\n    emaSource = x;\n    return indicator;\n  };\n  rebind(indicator, base, 'id', 'echo', 'type', 'stroke');\n  // rebind(indicator, underlyingAlgorithm, \"windowSize\", \"movingAverageType\", \"multiplier\", \"source\");\n  rebind(indicator, mergedAlgorithm, 'merge', 'skipUndefined');\n\n  return indicator;\n}\n"]}
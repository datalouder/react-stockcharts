{"version":3,"sources":["../../../src/lib/helper/SaveChartAsImage.js"],"names":["dx","dy","SaveChartAsImage","save","doc","container","background","cb","saveAsPng","svgAsDataUri","getElementsByTagName","uri","image","Image","onload","canvas","createElement","width","height","context","getContext","fillStyle","fillRect","canvasList","i","length","each","parent","parentNode","getBoundingClientRect","rect","drawImage","left","top","toDataURL","src","saveWithWhiteBG","saveWithBG","saveWithDarkBG","saveChartAsImage","document","a","setAttribute","body","appendChild","addEventListener","removeChild","click"],"mappings":"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","file":"SaveChartAsImage.js","sourcesContent":["import saveAsPng from 'save-svg-as-png';\nimport { isDefined } from '../utils';\n\nconst dx = 0;\nconst dy = 0;\n\nconst SaveChartAsImage = {\n  save(doc, container, background, cb) {\n    saveAsPng.svgAsDataUri(\n      container.getElementsByTagName('svg')[0],\n      {},\n      function (uri) {\n        // eslint-disable-next-line prefer-const\n        let image = new Image();\n        image.onload = function () {\n          // eslint-disable-next-line prefer-const\n          let canvas = doc.createElement('canvas');\n          canvas.width = image.width;\n          canvas.height = image.height;\n\n          // eslint-disable-next-line prefer-const\n          let context = canvas.getContext('2d');\n\n          if (isDefined(background)) {\n            context.fillStyle = background;\n            context.fillRect(0, 0, canvas.width, canvas.height);\n          }\n          const canvasList = container.getElementsByTagName('canvas');\n          for (let i = 0; i < canvasList.length; i++) {\n            const each = canvasList[i];\n            if (isDefined(each)) {\n              const parent = each.parentNode.parentNode.getBoundingClientRect();\n              const rect = each.getBoundingClientRect();\n              context.drawImage(\n                each,\n                rect.left - parent.left + dx,\n                rect.top - parent.top + dy\n              );\n            }\n          }\n\n          context.drawImage(image, dx, dy);\n          cb(canvas.toDataURL('image/png'));\n        };\n        image.src = uri;\n      }\n    );\n  },\n  saveWithWhiteBG(doc, container, cb) {\n    return this.saveWithBG(doc, container, 'white', cb);\n  },\n  saveWithDarkBG(doc, container, cb) {\n    return this.saveWithBG(doc, container, '#303030', cb);\n  },\n  saveWithBG(doc, container, background, cb) {\n    return this.save(doc, container, background, cb);\n  },\n  saveChartAsImage(container) {\n    this.saveWithWhiteBG(document, container, function (src) {\n      const a = document.createElement('a');\n      a.setAttribute('href', src);\n      a.setAttribute('download', 'Chart.png');\n\n      document.body.appendChild(a);\n      a.addEventListener('click', function (/* e */) {\n        a.parentNode.removeChild(a);\n      });\n\n      a.click();\n    });\n  },\n};\n\nexport default SaveChartAsImage;\n"]}
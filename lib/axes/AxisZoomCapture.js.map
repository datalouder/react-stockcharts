{"version":3,"sources":["../../../src/lib/axes/AxisZoomCapture.js"],"names":["AxisZoomCapture","props","handleDragStartMouse","bind","handleDragStartTouch","handleDrag","handleDragEnd","handleRightClick","saveNode","state","startPosition","node","e","stopPropagation","preventDefault","onContextMenu","mouseXY","getBoundingClientRect","on","MOUSEMOVE","MOUSEUP","setState","contextMenuClicked","mouseInteraction","getScale","getMoreProps","startScale","dragHappened","invert","startXY","touches","length","TOUCHMOVE","TOUCHEND","getMouseDelta","inverted","diff","center","range","tempRange","map","d","newDomain","axisZoomCallback","clicked","d3Event","onDoubleClick","setTimeout","bg","className","zoomCursorClassName","cursor","x","y","h","w","Component","propTypes","innerTickSize","PropTypes","number","outerTickSize","tickFormat","func","tickPadding","tickSize","ticks","tickValues","array","showDomain","bool","showTicks","string","object","isRequired","defaultProps","noop"],"mappings":"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","file":"AxisZoomCapture.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { select, event as d3Event, mouse, touches } from 'd3-selection';\nimport { mean } from 'd3-array';\n\nimport {\n  first,\n  last,\n  isDefined,\n  noop,\n  mousePosition,\n  d3Window,\n  MOUSEMOVE,\n  MOUSEUP,\n  TOUCHMOVE,\n  TOUCHEND,\n  touchPosition,\n  getTouchProps,\n  sign,\n} from '../utils';\n\nclass AxisZoomCapture extends Component {\n  constructor(props) {\n    super(props);\n    this.handleDragStartMouse = this.handleDragStartMouse.bind(this);\n    this.handleDragStartTouch = this.handleDragStartTouch.bind(this);\n    this.handleDrag = this.handleDrag.bind(this);\n    this.handleDragEnd = this.handleDragEnd.bind(this);\n    this.handleRightClick = this.handleRightClick.bind(this);\n    this.saveNode = this.saveNode.bind(this);\n    this.state = {\n      startPosition: null,\n    };\n  }\n  saveNode(node) {\n    this.node = node;\n  }\n  handleRightClick(e) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    const { onContextMenu } = this.props;\n\n    const mouseXY = mousePosition(e, this.node.getBoundingClientRect());\n\n    select(d3Window(this.node)).on(MOUSEMOVE, null).on(MOUSEUP, null);\n    this.setState({\n      startPosition: null,\n    });\n\n    onContextMenu(mouseXY, e);\n\n    this.contextMenuClicked = true;\n  }\n  handleDragStartMouse(e) {\n    this.mouseInteraction = true;\n\n    const { getScale, getMoreProps } = this.props;\n    const startScale = getScale(getMoreProps());\n    this.dragHappened = false;\n\n    if (startScale.invert) {\n      select(d3Window(this.node))\n        .on(MOUSEMOVE, this.handleDrag, false)\n        .on(MOUSEUP, this.handleDragEnd, false);\n\n      const startXY = mousePosition(e);\n\n      this.setState({\n        startPosition: {\n          startXY,\n          startScale,\n        },\n      });\n    }\n    e.preventDefault();\n  }\n  handleDragStartTouch(e) {\n    this.mouseInteraction = false;\n\n    const { getScale, getMoreProps } = this.props;\n    const startScale = getScale(getMoreProps());\n    this.dragHappened = false;\n\n    if (e.touches.length === 1 && startScale.invert) {\n      select(d3Window(this.node))\n        .on(TOUCHMOVE, this.handleDrag)\n        .on(TOUCHEND, this.handleDragEnd);\n\n      const startXY = touchPosition(getTouchProps(e.touches[0]), e);\n\n      this.setState({\n        startPosition: {\n          startXY,\n          startScale,\n        },\n      });\n    }\n  }\n  handleDrag() {\n    const { startPosition } = this.state;\n    const { getMouseDelta, inverted } = this.props;\n\n    this.dragHappened = true;\n    if (isDefined(startPosition)) {\n      const { startScale } = startPosition;\n      const { startXY } = startPosition;\n\n      const mouseXY = this.mouseInteraction\n        ? mouse(this.node)\n        : touches(this.node)[0];\n\n      const diff = getMouseDelta(startXY, mouseXY);\n\n      const center = mean(startScale.range());\n\n      const tempRange = startScale\n        .range()\n        .map(d =>\n          inverted ? d - sign(d - center) * diff : d + sign(d - center) * diff\n        );\n\n      const newDomain = tempRange.map(startScale.invert);\n\n      if (\n        sign(last(startScale.range()) - first(startScale.range())) ===\n        sign(last(tempRange) - first(tempRange))\n      ) {\n        const { axisZoomCallback } = this.props;\n        // console.log(startXScale.domain(), newXDomain)\n        axisZoomCallback(newDomain);\n      }\n    }\n  }\n  handleDragEnd() {\n    if (!this.dragHappened) {\n      if (this.clicked) {\n        const e = d3Event;\n        const mouseXY = this.mouseInteraction\n          ? mouse(this.node)\n          : touches(this.node)[0];\n        const { onDoubleClick } = this.props;\n\n        onDoubleClick(mouseXY, e);\n      } else {\n        this.clicked = true;\n        setTimeout(() => {\n          this.clicked = false;\n        }, 300);\n      }\n    }\n\n    select(d3Window(this.node))\n      .on(MOUSEMOVE, null)\n      .on(MOUSEUP, null)\n      .on(TOUCHMOVE, null)\n      .on(TOUCHEND, null);\n\n    this.setState({\n      startPosition: null,\n    });\n  }\n  render() {\n    const { bg, className, zoomCursorClassName } = this.props;\n\n    const cursor = isDefined(this.state.startPosition)\n      ? zoomCursorClassName\n      : 'react-stockcharts-default-cursor';\n\n    return (\n      <rect\n        className={`react-stockcharts-enable-interaction ${cursor} ${className}`}\n        ref={this.saveNode}\n        x={bg.x}\n        y={bg.y}\n        opacity={0}\n        height={bg.h}\n        width={bg.w}\n        onContextMenu={this.handleRightClick}\n        onMouseDown={this.handleDragStartMouse}\n        onTouchStart={this.handleDragStartTouch}\n      />\n    );\n  }\n}\n\nAxisZoomCapture.propTypes = {\n  innerTickSize: PropTypes.number,\n  outerTickSize: PropTypes.number,\n  tickFormat: PropTypes.func,\n  tickPadding: PropTypes.number,\n  tickSize: PropTypes.number,\n  ticks: PropTypes.number,\n  tickValues: PropTypes.array,\n  showDomain: PropTypes.bool,\n  showTicks: PropTypes.bool,\n  className: PropTypes.string,\n  axisZoomCallback: PropTypes.func,\n  inverted: PropTypes.bool,\n  bg: PropTypes.object.isRequired,\n  zoomCursorClassName: PropTypes.string.isRequired,\n  getMoreProps: PropTypes.func.isRequired,\n  getScale: PropTypes.func.isRequired,\n  getMouseDelta: PropTypes.func.isRequired,\n  onDoubleClick: PropTypes.func.isRequired,\n  onContextMenu: PropTypes.func.isRequired,\n};\n\nAxisZoomCapture.defaultProps = {\n  onDoubleClick: noop,\n  onContextMenu: noop,\n  inverted: true,\n};\n\nexport default AxisZoomCapture;\n"]}
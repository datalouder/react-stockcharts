{"version":3,"sources":["../../../../src/lib/tooltip/HoverTooltip.js"],"names":["React","Component","PropTypes","GenericComponent","sum","first","last","isNotDefined","isDefined","hexToRGBA","HoverTooltip","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","pointer","helper","height","context","bgFill","bgOpacity","backgroundShapeSVG","tooltipSVG","bgheight","bgwidth","x","y","content","centerX","pointWidth","bgSize","bgShape","width","propTypes","chartId","oneOfType","number","string","yAccessor","func","isRequired","tooltipContent","origin","array","fontFamily","fontSize","contextTypes","margin","object","ratio","defaultProps","tooltipCanvas","fill","stroke","fontFill","opacity","backgroundShapeCanvas","PADDING","X","Y","tspans","startY","i","length","textY","push","label","value","fillStyle","strokeStyle","beginPath","rect","font","textAlign","fillText","measureText","originX","left","originY","top","save","setTransform","scale","translate","restore","calculateTooltipSize","canvas","document","createElement","getContext","str","map","reduce","res","size","sumSizes","String","sizes","Math","max","d","normalizeX","normalizeY","mouseXY","xAccessor","currentItem","xScale","chartConfig","xValue","round","findIndex","yValue","chartIndex","id","yScale","show","plotData","displayXAccessor","abs"],"mappings":"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","file":"HoverTooltip.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport GenericComponent from '../GenericComponent';\nimport { sum } from 'd3-array';\n\nimport { first, last, isNotDefined, isDefined, hexToRGBA } from '../utils';\n\nclass HoverTooltip extends Component {\n  constructor(props) {\n    super(props);\n    this.renderSVG = this.renderSVG.bind(this);\n    this.drawOnCanvas = this.drawOnCanvas.bind(this);\n  }\n  drawOnCanvas(ctx, moreProps) {\n    const pointer = helper(this.props, moreProps, ctx);\n    const { height } = moreProps;\n\n    if (isNotDefined(pointer)) return null;\n    drawOnCanvas(ctx, this.props, this.context, pointer, height, moreProps);\n  }\n  render() {\n    return (\n      <GenericComponent\n        svgDraw={this.renderSVG}\n        canvasDraw={this.drawOnCanvas}\n        drawOn={['mousemove', 'pan' /* , \"mouseleave\" */]}\n      />\n    );\n  }\n  renderSVG(moreProps) {\n    const pointer = helper(this.props, moreProps);\n\n    if (isNotDefined(pointer)) return null;\n\n    const { bgFill, bgOpacity, backgroundShapeSVG, tooltipSVG } = this.props;\n    const { bgheight, bgwidth } = this.props;\n    const { height } = moreProps;\n\n    const { x, y, content, centerX, pointWidth, bgSize } = pointer;\n\n    const bgShape =\n      isDefined(bgwidth) && isDefined(bgheight)\n        ? { width: bgwidth, height: bgheight }\n        : bgSize;\n\n    return (\n      <g>\n        <rect\n          x={centerX - pointWidth / 2}\n          y={0}\n          width={pointWidth}\n          height={height}\n          fill={bgFill}\n          opacity={bgOpacity}\n        />\n        <g\n          className=\"react-stockcharts-tooltip-content\"\n          transform={`translate(${x}, ${y})`}\n        >\n          {backgroundShapeSVG(this.props, bgShape)}\n          {tooltipSVG(this.props, content)}\n        </g>\n      </g>\n    );\n  }\n}\n\nHoverTooltip.propTypes = {\n  chartId: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  yAccessor: PropTypes.func,\n  tooltipSVG: PropTypes.func,\n  backgroundShapeSVG: PropTypes.func,\n  bgwidth: PropTypes.number,\n  bgheight: PropTypes.number,\n  bgFill: PropTypes.string.isRequired,\n  bgOpacity: PropTypes.number.isRequired,\n  tooltipContent: PropTypes.func.isRequired,\n  origin: PropTypes.oneOfType([PropTypes.array, PropTypes.func]).isRequired,\n  fontFamily: PropTypes.string,\n  fontSize: PropTypes.number,\n};\n\nHoverTooltip.contextTypes = {\n  margin: PropTypes.object.isRequired,\n  ratio: PropTypes.number.isRequired,\n};\n\nHoverTooltip.defaultProps = {\n  // bgwidth: 150,\n  // bgheight: 50,\n  tooltipSVG: tooltipSVG,\n  tooltipCanvas: tooltipCanvas,\n  origin: origin,\n  fill: '#D4E2FD',\n  bgFill: '#D4E2FD',\n  bgOpacity: 0.5,\n  stroke: '#9B9BFF',\n  fontFill: '#000000',\n  opacity: 0.8,\n  backgroundShapeSVG: backgroundShapeSVG,\n  backgroundShapeCanvas: backgroundShapeCanvas,\n  fontFamily: 'Helvetica Neue, Helvetica, Arial, sans-serif',\n  fontSize: 12,\n};\n\nconst PADDING = 5;\nconst X = 10;\nconst Y = 10;\n\n/* eslint-disable react/prop-types */\nfunction backgroundShapeSVG({ fill, stroke, opacity }, { height, width }) {\n  return (\n    <rect\n      height={height}\n      width={width}\n      fill={fill}\n      opacity={opacity}\n      stroke={stroke}\n    />\n  );\n}\n\nfunction tooltipSVG({ fontFamily, fontSize, fontFill }, content) {\n  const tspans = [];\n  const startY = Y + fontSize * 0.9;\n\n  for (let i = 0; i < content.y.length; i++) {\n    const y = content.y[i];\n    const textY = startY + fontSize * (i + 1);\n\n    tspans.push(\n      <tspan key={`L-${i}`} x={X} y={textY} fill={y.stroke}>\n        {y.label}\n      </tspan>\n    );\n    tspans.push(<tspan key={i}>: </tspan>);\n    tspans.push(<tspan key={`V-${i}`}>{y.value}</tspan>);\n  }\n  return (\n    <text fontFamily={fontFamily} fontSize={fontSize} fill={fontFill}>\n      <tspan x={X} y={startY}>\n        {content.x}\n      </tspan>\n      {tspans}\n    </text>\n  );\n}\n/* eslint-enable react/prop-types */\n\nfunction backgroundShapeCanvas(props, { width, height }, ctx) {\n  const { fill, stroke, opacity } = props;\n\n  ctx.fillStyle = hexToRGBA(fill, opacity);\n  ctx.strokeStyle = stroke;\n  ctx.beginPath();\n  ctx.rect(0, 0, width, height);\n  ctx.fill();\n  ctx.stroke();\n}\n\nfunction tooltipCanvas({ fontFamily, fontSize, fontFill }, content, ctx) {\n  const startY = Y + fontSize * 0.9;\n  ctx.font = `${fontSize}px ${fontFamily}`;\n  ctx.fillStyle = fontFill;\n  ctx.textAlign = 'left';\n  ctx.fillText(content.x, X, startY);\n\n  for (let i = 0; i < content.y.length; i++) {\n    const y = content.y[i];\n    const textY = startY + fontSize * (i + 1);\n    ctx.fillStyle = y.stroke || fontFill;\n    ctx.fillText(y.label, X, textY);\n\n    ctx.fillStyle = fontFill;\n    ctx.fillText(': ' + y.value, X + ctx.measureText(y.label).width, textY);\n  }\n}\n\nfunction drawOnCanvas(ctx, props, context, pointer, height) {\n  const { margin, ratio } = context;\n  const { bgFill, bgOpacity } = props;\n  const { backgroundShapeCanvas, tooltipCanvas } = props;\n\n  const originX = 0.5 * ratio + margin.left;\n  const originY = 0.5 * ratio + margin.top;\n\n  ctx.save();\n\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n  ctx.scale(ratio, ratio);\n\n  ctx.translate(originX, originY);\n\n  const { x, y, content, centerX, pointWidth, bgSize } = pointer;\n\n  ctx.fillStyle = hexToRGBA(bgFill, bgOpacity);\n  ctx.beginPath();\n  ctx.rect(centerX - pointWidth / 2, 0, pointWidth, height);\n  ctx.fill();\n\n  ctx.translate(x, y);\n  backgroundShapeCanvas(props, bgSize, ctx);\n  tooltipCanvas(props, content, ctx);\n\n  ctx.restore();\n}\n\nfunction calculateTooltipSize(\n  { fontFamily, fontSize, fontFill },\n  content,\n  ctx\n) {\n  if (isNotDefined(ctx)) {\n    const canvas = document.createElement('canvas');\n    ctx = canvas.getContext('2d');\n  }\n\n  ctx.font = `${fontSize}px ${fontFamily}`;\n  ctx.fillStyle = fontFill;\n  ctx.textAlign = 'left';\n\n  const measureText = str => ({\n    width: ctx.measureText(str).width,\n    height: fontSize,\n  });\n\n  const { width, height } = content.y\n    .map(({ label, value }) => measureText(`${label}: ${value}`))\n    // Sum all y and x sizes (begin with x label size)\n    .reduce((res, size) => sumSizes(res, size), measureText(String(content.x)));\n  return {\n    width: width + 2 * X,\n    height: height + 2 * Y,\n  };\n}\n\nfunction sumSizes(...sizes) {\n  return {\n    width: Math.max(...sizes.map(size => size.width)),\n    height: sum(sizes, d => d.height),\n  };\n}\n\nfunction normalizeX(x, bgSize, pointWidth, width) {\n  // return x - bgSize.width - pointWidth / 2 - PADDING * 2 < 0\n  return x < width / 2\n    ? x + pointWidth / 2 + PADDING\n    : x - bgSize.width - pointWidth / 2 - PADDING;\n}\n\nfunction normalizeY(y, bgSize) {\n  return y - bgSize.height <= 0 ? y + PADDING : y - bgSize.height - PADDING;\n}\n\nfunction origin(props, moreProps, bgSize, pointWidth) {\n  const { chartId, yAccessor } = props;\n  const { mouseXY, xAccessor, currentItem, xScale, chartConfig, width } =\n    moreProps;\n  let y = last(mouseXY);\n\n  const xValue = xAccessor(currentItem);\n  let x = Math.round(xScale(xValue));\n\n  if (\n    isDefined(chartId) &&\n    isDefined(yAccessor) &&\n    isDefined(chartConfig) &&\n    isDefined(chartConfig.findIndex)\n  ) {\n    const yValue = yAccessor(currentItem);\n    const chartIndex = chartConfig.findIndex(x => x.id === chartId);\n\n    y = Math.round(chartConfig[chartIndex].yScale(yValue));\n  }\n\n  x = normalizeX(x, bgSize, pointWidth, width);\n  y = normalizeY(y, bgSize);\n\n  return [x, y];\n}\n\nfunction helper(props, moreProps, ctx) {\n  const { show, xScale, currentItem, plotData } = moreProps;\n  const { origin, tooltipContent } = props;\n  const { xAccessor, displayXAccessor } = moreProps;\n\n  if (!show || isNotDefined(currentItem)) return;\n\n  const xValue = xAccessor(currentItem);\n\n  if (!show || isNotDefined(xValue)) return;\n\n  const content = tooltipContent({ currentItem, xAccessor: displayXAccessor });\n  const centerX = xScale(xValue);\n  const pointWidth =\n    Math.abs(\n      xScale(xAccessor(last(plotData))) - xScale(xAccessor(first(plotData)))\n    ) /\n    (plotData.length - 1);\n\n  const bgSize = calculateTooltipSize(props, content, ctx);\n\n  const [x, y] = origin(props, moreProps, bgSize, pointWidth);\n\n  return { x, y, content, centerX, pointWidth, bgSize };\n}\n\nexport default HoverTooltip;\n"]}
{"version":3,"sources":["../../../../src/lib/axes/AxisZoomCapture.js"],"names":["React","Component","PropTypes","select","event","d3Event","mouse","touches","mean","first","last","isDefined","noop","mousePosition","d3Window","MOUSEMOVE","MOUSEUP","TOUCHMOVE","TOUCHEND","touchPosition","getTouchProps","sign","AxisZoomCapture","props","handleDragStartMouse","bind","handleDragStartTouch","handleDrag","handleDragEnd","handleRightClick","saveNode","state","startPosition","node","e","stopPropagation","preventDefault","onContextMenu","mouseXY","getBoundingClientRect","on","setState","contextMenuClicked","mouseInteraction","getScale","getMoreProps","startScale","dragHappened","invert","startXY","length","getMouseDelta","inverted","diff","center","range","tempRange","map","d","newDomain","axisZoomCallback","clicked","onDoubleClick","setTimeout","bg","className","zoomCursorClassName","cursor","x","y","h","w","propTypes","innerTickSize","number","outerTickSize","tickFormat","func","tickPadding","tickSize","ticks","tickValues","array","showDomain","bool","showTicks","string","object","isRequired","defaultProps"],"mappings":"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","file":"AxisZoomCapture.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { select, event as d3Event, mouse, touches } from 'd3-selection';\nimport { mean } from 'd3-array';\n\nimport {\n  first,\n  last,\n  isDefined,\n  noop,\n  mousePosition,\n  d3Window,\n  MOUSEMOVE,\n  MOUSEUP,\n  TOUCHMOVE,\n  TOUCHEND,\n  touchPosition,\n  getTouchProps,\n  sign,\n} from '../utils';\n\nclass AxisZoomCapture extends Component {\n  constructor(props) {\n    super(props);\n    this.handleDragStartMouse = this.handleDragStartMouse.bind(this);\n    this.handleDragStartTouch = this.handleDragStartTouch.bind(this);\n    this.handleDrag = this.handleDrag.bind(this);\n    this.handleDragEnd = this.handleDragEnd.bind(this);\n    this.handleRightClick = this.handleRightClick.bind(this);\n    this.saveNode = this.saveNode.bind(this);\n    this.state = {\n      startPosition: null,\n    };\n  }\n  saveNode(node) {\n    this.node = node;\n  }\n  handleRightClick(e) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    const { onContextMenu } = this.props;\n\n    const mouseXY = mousePosition(e, this.node.getBoundingClientRect());\n\n    select(d3Window(this.node)).on(MOUSEMOVE, null).on(MOUSEUP, null);\n    this.setState({\n      startPosition: null,\n    });\n\n    onContextMenu(mouseXY, e);\n\n    this.contextMenuClicked = true;\n  }\n  handleDragStartMouse(e) {\n    this.mouseInteraction = true;\n\n    const { getScale, getMoreProps } = this.props;\n    const startScale = getScale(getMoreProps());\n    this.dragHappened = false;\n\n    if (startScale.invert) {\n      select(d3Window(this.node))\n        .on(MOUSEMOVE, this.handleDrag, false)\n        .on(MOUSEUP, this.handleDragEnd, false);\n\n      const startXY = mousePosition(e);\n\n      this.setState({\n        startPosition: {\n          startXY,\n          startScale,\n        },\n      });\n    }\n    e.preventDefault();\n  }\n  handleDragStartTouch(e) {\n    this.mouseInteraction = false;\n\n    const { getScale, getMoreProps } = this.props;\n    const startScale = getScale(getMoreProps());\n    this.dragHappened = false;\n\n    if (e.touches.length === 1 && startScale.invert) {\n      select(d3Window(this.node))\n        .on(TOUCHMOVE, this.handleDrag)\n        .on(TOUCHEND, this.handleDragEnd);\n\n      const startXY = touchPosition(getTouchProps(e.touches[0]), e);\n\n      this.setState({\n        startPosition: {\n          startXY,\n          startScale,\n        },\n      });\n    }\n  }\n  handleDrag() {\n    const { startPosition } = this.state;\n    const { getMouseDelta, inverted } = this.props;\n\n    this.dragHappened = true;\n    if (isDefined(startPosition)) {\n      const { startScale } = startPosition;\n      const { startXY } = startPosition;\n\n      const mouseXY = this.mouseInteraction\n        ? mouse(this.node)\n        : touches(this.node)[0];\n\n      const diff = getMouseDelta(startXY, mouseXY);\n\n      const center = mean(startScale.range());\n\n      const tempRange = startScale\n        .range()\n        .map(d =>\n          inverted ? d - sign(d - center) * diff : d + sign(d - center) * diff\n        );\n\n      const newDomain = tempRange.map(startScale.invert);\n\n      if (\n        sign(last(startScale.range()) - first(startScale.range())) ===\n        sign(last(tempRange) - first(tempRange))\n      ) {\n        const { axisZoomCallback } = this.props;\n        // console.log(startXScale.domain(), newXDomain)\n        axisZoomCallback(newDomain);\n      }\n    }\n  }\n  handleDragEnd() {\n    if (!this.dragHappened) {\n      if (this.clicked) {\n        const e = d3Event;\n        const mouseXY = this.mouseInteraction\n          ? mouse(this.node)\n          : touches(this.node)[0];\n        const { onDoubleClick } = this.props;\n\n        onDoubleClick(mouseXY, e);\n      } else {\n        this.clicked = true;\n        setTimeout(() => {\n          this.clicked = false;\n        }, 300);\n      }\n    }\n\n    select(d3Window(this.node))\n      .on(MOUSEMOVE, null)\n      .on(MOUSEUP, null)\n      .on(TOUCHMOVE, null)\n      .on(TOUCHEND, null);\n\n    this.setState({\n      startPosition: null,\n    });\n  }\n  render() {\n    const { bg, className, zoomCursorClassName } = this.props;\n\n    const cursor = isDefined(this.state.startPosition)\n      ? zoomCursorClassName\n      : 'react-stockcharts-default-cursor';\n\n    return (\n      <rect\n        className={`react-stockcharts-enable-interaction ${cursor} ${className}`}\n        ref={this.saveNode}\n        x={bg.x}\n        y={bg.y}\n        opacity={0}\n        height={bg.h}\n        width={bg.w}\n        onContextMenu={this.handleRightClick}\n        onMouseDown={this.handleDragStartMouse}\n        onTouchStart={this.handleDragStartTouch}\n      />\n    );\n  }\n}\n\nAxisZoomCapture.propTypes = {\n  innerTickSize: PropTypes.number,\n  outerTickSize: PropTypes.number,\n  tickFormat: PropTypes.func,\n  tickPadding: PropTypes.number,\n  tickSize: PropTypes.number,\n  ticks: PropTypes.number,\n  tickValues: PropTypes.array,\n  showDomain: PropTypes.bool,\n  showTicks: PropTypes.bool,\n  className: PropTypes.string,\n  axisZoomCallback: PropTypes.func,\n  inverted: PropTypes.bool,\n  bg: PropTypes.object.isRequired,\n  zoomCursorClassName: PropTypes.string.isRequired,\n  getMoreProps: PropTypes.func.isRequired,\n  getScale: PropTypes.func.isRequired,\n  getMouseDelta: PropTypes.func.isRequired,\n  onDoubleClick: PropTypes.func.isRequired,\n  onContextMenu: PropTypes.func.isRequired,\n};\n\nAxisZoomCapture.defaultProps = {\n  onDoubleClick: noop,\n  onContextMenu: noop,\n  inverted: true,\n};\n\nexport default AxisZoomCapture;\n"]}
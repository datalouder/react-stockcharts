{"version":3,"sources":["../../../../src/lib/utils/mappedSlidingWindow.js"],"names":["noop","identity","functor","undefinedValue","undefined","windowSize","accumulator","source","skipInitial","mappedSlidingWindow","data","size","apply","arguments","windowData","accumulatorIdx","undef","result","forEach","d","i","mapped","push","shift","pop","x","length"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,QAAjB;AACA,OAAOC,QAAP,MAAqB,YAArB;AACA,SAASC,OAAT,QAAwB,SAAxB;;AAEA,eAAe,YAAY;AACzB,MAAIC,iBAAiBC,SAArB;AAAA,MACEC,aAAa,EADf;AAAA,MAEEC,cAAcN,IAFhB;AAAA,MAGEO,SAASN,QAHX;AAAA,MAIEO,cAAc,CAJhB;;AAMA;AACA,MAAIC,sBAAsB,SAAtBA,mBAAsB,CAAUC,IAAV,EAAgB;AACxC,QAAMC,OAAOT,QAAQG,UAAR,EAAoBO,KAApB,CAA0B,IAA1B,EAAgCC,SAAhC,CAAb;AACA,QAAMC,aAAa,EAAnB;AACA,QAAIC,iBAAiB,CAArB;AACA,QAAMC,QAAQd,QAAQC,cAAR,CAAd;AACA;AACA,QAAMc,SAAS,EAAf;AACAP,SAAKQ,OAAL,CAAa,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAC3B;AACA,UAAIC,eAAJ;AACA,UAAID,IAAIZ,cAAcG,IAAd,GAAqB,CAA7B,EAAgC;AAC9BU,iBAASL,MAAMG,CAAN,EAASC,CAAT,CAAT;AACAH,eAAOK,IAAP,CAAYD,MAAZ;AACAP,mBAAWQ,IAAX,CAAgBD,MAAhB;AACA;AACD;AACD,UAAID,KAAKZ,cAAcG,IAAvB,EAA6B;AAC3B;AACAG,mBAAWS,KAAX;AACD;AACDT,iBAAWQ,IAAX,CAAgBf,OAAOY,CAAP,EAAUC,CAAV,CAAhB;AACAC,eAASf,YAAYQ,UAAZ,EAAwBM,CAAxB,EAA2BL,gBAA3B,CAAT;AACAE,aAAOK,IAAP,CAAYD,MAAZ;AACAP,iBAAWU,GAAX;AACAV,iBAAWQ,IAAX,CAAgBD,MAAhB;AACA;AACD,KAnBD;AAoBA,WAAOJ,MAAP;AACD,GA5BD;;AA8BAR,sBAAoBN,cAApB,GAAqC,UAAUsB,CAAV,EAAa;AAChD,QAAI,CAACZ,UAAUa,MAAf,EAAuB;AACrB,aAAOvB,cAAP;AACD;AACDA,qBAAiBsB,CAAjB;AACA,WAAOhB,mBAAP;AACD,GAND;AAOAA,sBAAoBJ,UAApB,GAAiC,UAAUoB,CAAV,EAAa;AAC5C,QAAI,CAACZ,UAAUa,MAAf,EAAuB;AACrB,aAAOrB,UAAP;AACD;AACDA,iBAAaoB,CAAb;AACA,WAAOhB,mBAAP;AACD,GAND;AAOAA,sBAAoBH,WAApB,GAAkC,UAAUmB,CAAV,EAAa;AAC7C,QAAI,CAACZ,UAAUa,MAAf,EAAuB;AACrB,aAAOpB,WAAP;AACD;AACDA,kBAAcmB,CAAd;AACA,WAAOhB,mBAAP;AACD,GAND;AAOAA,sBAAoBD,WAApB,GAAkC,UAAUiB,CAAV,EAAa;AAC7C,QAAI,CAACZ,UAAUa,MAAf,EAAuB;AACrB,aAAOlB,WAAP;AACD;AACDA,kBAAciB,CAAd;AACA,WAAOhB,mBAAP;AACD,GAND;AAOAA,sBAAoBF,MAApB,GAA6B,UAAUkB,CAAV,EAAa;AACxC,QAAI,CAACZ,UAAUa,MAAf,EAAuB;AACrB,aAAOnB,MAAP;AACD;AACDA,aAASkB,CAAT;AACA,WAAOhB,mBAAP;AACD,GAND;;AAQA,SAAOA,mBAAP;AACD","file":"mappedSlidingWindow.js","sourcesContent":["import noop from './noop';\nimport identity from './identity';\nimport { functor } from './index';\n\nexport default function () {\n  let undefinedValue = undefined,\n    windowSize = 10,\n    accumulator = noop,\n    source = identity,\n    skipInitial = 0;\n\n  // eslint-disable-next-line prefer-const\n  let mappedSlidingWindow = function (data) {\n    const size = functor(windowSize).apply(this, arguments);\n    const windowData = [];\n    let accumulatorIdx = 0;\n    const undef = functor(undefinedValue);\n    // console.log(skipInitial, size, data.length, windowData.length);\n    const result = [];\n    data.forEach(function (d, i) {\n      // console.log(d, i, windowData.length);\n      let mapped;\n      if (i < skipInitial + size - 1) {\n        mapped = undef(d, i);\n        result.push(mapped);\n        windowData.push(mapped);\n        return;\n      }\n      if (i >= skipInitial + size) {\n        // Treat windowData as FIFO rolling buffer\n        windowData.shift();\n      }\n      windowData.push(source(d, i));\n      mapped = accumulator(windowData, i, accumulatorIdx++);\n      result.push(mapped);\n      windowData.pop();\n      windowData.push(mapped);\n      return;\n    });\n    return result;\n  };\n\n  mappedSlidingWindow.undefinedValue = function (x) {\n    if (!arguments.length) {\n      return undefinedValue;\n    }\n    undefinedValue = x;\n    return mappedSlidingWindow;\n  };\n  mappedSlidingWindow.windowSize = function (x) {\n    if (!arguments.length) {\n      return windowSize;\n    }\n    windowSize = x;\n    return mappedSlidingWindow;\n  };\n  mappedSlidingWindow.accumulator = function (x) {\n    if (!arguments.length) {\n      return accumulator;\n    }\n    accumulator = x;\n    return mappedSlidingWindow;\n  };\n  mappedSlidingWindow.skipInitial = function (x) {\n    if (!arguments.length) {\n      return skipInitial;\n    }\n    skipInitial = x;\n    return mappedSlidingWindow;\n  };\n  mappedSlidingWindow.source = function (x) {\n    if (!arguments.length) {\n      return source;\n    }\n    source = x;\n    return mappedSlidingWindow;\n  };\n\n  return mappedSlidingWindow;\n}\n"]}
{"version":3,"sources":["../../../../src/lib/annotation/Label.js"],"names":["React","Component","PropTypes","GenericComponent","isDefined","hexToRGBA","functor","LabelAnnotation","defaultProps","helper","Label","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","drawOnCanvas2","context","selectCanvas","chartConfig","getYScale","getText","text","Array","isArray","undefined","yScale","propTypes","className","string","func","oneOfType","isRequired","textAnchor","fontFamily","fontSize","number","opacity","rotate","onClick","xAccessor","xScale","datum","object","x","y","contextTypes","canvasOriginX","canvasOriginY","margin","ratio","canvases","bg","save","setTransform","scale","translate","left","top","restore","xPos","yPos","fill","radians","Math","PI","font","fillStyle","textAlign","beginPath","fillText"],"mappings":"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","file":"Label.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport GenericComponent from '../GenericComponent';\n\nimport { isDefined, hexToRGBA, functor } from '../utils';\nimport LabelAnnotation, { defaultProps, helper } from './LabelAnnotation';\n\nclass Label extends Component {\n  constructor(props) {\n    super(props);\n    this.renderSVG = this.renderSVG.bind(this);\n    this.drawOnCanvas = this.drawOnCanvas.bind(this);\n  }\n  drawOnCanvas(ctx, moreProps) {\n    drawOnCanvas2(ctx, this.props, this.context, moreProps);\n  }\n  render() {\n    return (\n      <GenericComponent\n        canvasToDraw={this.props.selectCanvas}\n        svgDraw={this.renderSVG}\n        canvasDraw={this.drawOnCanvas}\n        drawOn={[]}\n      />\n    );\n  }\n  renderSVG(moreProps) {\n    const { chartConfig } = moreProps;\n\n    return (\n      <LabelAnnotation\n        yScale={getYScale(chartConfig)}\n        {...this.props}\n        text={getText(this.props)}\n      />\n    );\n  }\n}\n\nfunction getText(props) {\n  return functor(props.text)(props);\n}\n\nfunction getYScale(chartConfig) {\n  return Array.isArray(chartConfig) ? undefined : chartConfig.yScale;\n}\n\nLabel.propTypes = {\n  className: PropTypes.string,\n  selectCanvas: PropTypes.func,\n  text: PropTypes.oneOfType([PropTypes.string, PropTypes.func]).isRequired,\n  textAnchor: PropTypes.string,\n  fontFamily: PropTypes.string,\n  fontSize: PropTypes.number,\n  opacity: PropTypes.number,\n  rotate: PropTypes.number,\n  onClick: PropTypes.func,\n  xAccessor: PropTypes.func,\n  xScale: PropTypes.func,\n  yScale: PropTypes.func,\n  datum: PropTypes.object,\n  x: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  y: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n};\n\nLabel.contextTypes = {\n  canvasOriginX: PropTypes.number,\n  canvasOriginY: PropTypes.number,\n\n  margin: PropTypes.object.isRequired,\n  ratio: PropTypes.number.isRequired,\n};\n\nLabel.defaultProps = {\n  ...defaultProps,\n  selectCanvas: canvases => canvases.bg,\n};\n\nfunction drawOnCanvas2(ctx, props, context, moreProps) {\n  ctx.save();\n\n  const { canvasOriginX, canvasOriginY, margin, ratio } = context;\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n  ctx.scale(ratio, ratio);\n\n  if (isDefined(canvasOriginX)) ctx.translate(canvasOriginX, canvasOriginY);\n  else ctx.translate(margin.left + 0.5 * ratio, margin.top + 0.5 * ratio);\n\n  drawOnCanvas(ctx, props, moreProps);\n\n  ctx.restore();\n}\n\nfunction drawOnCanvas(ctx, props, moreProps) {\n  const { textAnchor, fontFamily, fontSize, opacity, rotate } = props;\n  const { xScale, chartConfig, xAccessor } = moreProps;\n\n  const { xPos, yPos, fill, text } = helper(\n    props,\n    xAccessor,\n    xScale,\n    getYScale(chartConfig)\n  );\n\n  const radians = (rotate / 180) * Math.PI;\n  ctx.save();\n  ctx.translate(xPos, yPos);\n  ctx.rotate(radians);\n\n  ctx.font = `${fontSize}px ${fontFamily}`;\n  ctx.fillStyle = hexToRGBA(fill, opacity);\n  ctx.textAlign = textAnchor === 'middle' ? 'center' : textAnchor;\n\n  ctx.beginPath();\n  ctx.fillText(text, 0, 0);\n  ctx.restore();\n}\n\nexport default Label;\n"]}
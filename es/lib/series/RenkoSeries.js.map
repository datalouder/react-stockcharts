{"version":3,"sources":["../../../../src/lib/series/RenkoSeries.js"],"names":["React","Component","PropTypes","GenericChartComponent","getAxisCanvas","isDefined","RenkoSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","xAccessor","xScale","yScale","chartConfig","plotData","yAccessor","candles","getRenko","clip","map","each","idx","className","fill","x","y","width","height","propTypes","classNames","shape","up","string","down","stroke","partial","func","isRequired","bool","defaultProps","open","d","high","low","close","renko","forEach","beginPath","strokeStyle","fillStyle","rect","closePath","length","candleWidth","filter","ohlc","Math","max","abs","svgfill","fullyFormed"],"mappings":"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","file":"RenkoSeries.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport GenericChartComponent from '../GenericChartComponent';\nimport { getAxisCanvas } from '../GenericComponent';\n\nimport { isDefined } from '../utils';\n\nclass RenkoSeries extends Component {\n  constructor(props) {\n    super(props);\n    this.renderSVG = this.renderSVG.bind(this);\n    this.drawOnCanvas = this.drawOnCanvas.bind(this);\n  }\n  drawOnCanvas(ctx, moreProps) {\n    const { xAccessor } = moreProps;\n    const {\n      xScale,\n      chartConfig: { yScale },\n      plotData,\n    } = moreProps;\n\n    const { yAccessor } = this.props;\n\n    const candles = getRenko(\n      this.props,\n      plotData,\n      xScale,\n      xAccessor,\n      yScale,\n      yAccessor\n    );\n\n    drawOnCanvas(ctx, candles);\n  }\n  render() {\n    const { clip } = this.props;\n\n    return (\n      <GenericChartComponent\n        clip={clip}\n        svgDraw={this.renderSVG}\n        canvasDraw={this.drawOnCanvas}\n        canvasToDraw={getAxisCanvas}\n        drawOn={['pan']}\n      />\n    );\n  }\n  renderSVG(moreProps) {\n    const { xAccessor } = moreProps;\n    const {\n      xScale,\n      chartConfig: { yScale },\n      plotData,\n    } = moreProps;\n\n    const { yAccessor } = this.props;\n\n    const candles = getRenko(\n      this.props,\n      plotData,\n      xScale,\n      xAccessor,\n      yScale,\n      yAccessor\n    ).map((each, idx) => (\n      <rect\n        key={idx}\n        className={each.className}\n        fill={each.fill}\n        x={each.x}\n        y={each.y}\n        width={each.width}\n        height={each.height}\n      />\n    ));\n\n    return (\n      <g>\n        <g className=\"candle\">{candles}</g>\n      </g>\n    );\n  }\n}\n\nRenkoSeries.propTypes = {\n  classNames: PropTypes.shape({\n    up: PropTypes.string,\n    down: PropTypes.string,\n  }),\n  stroke: PropTypes.shape({\n    up: PropTypes.string,\n    down: PropTypes.string,\n  }),\n  fill: PropTypes.shape({\n    up: PropTypes.string,\n    down: PropTypes.string,\n    partial: PropTypes.string,\n  }),\n  yAccessor: PropTypes.func.isRequired,\n  clip: PropTypes.bool.isRequired,\n};\n\nRenkoSeries.defaultProps = {\n  classNames: {\n    up: 'up',\n    down: 'down',\n  },\n  stroke: {\n    up: 'none',\n    down: 'none',\n  },\n  fill: {\n    up: '#6BA583',\n    down: '#E60000',\n    partial: '#4682B4',\n  },\n  yAccessor: d => ({ open: d.open, high: d.high, low: d.low, close: d.close }),\n  clip: true,\n};\n\nfunction drawOnCanvas(ctx, renko) {\n  renko.forEach(d => {\n    ctx.beginPath();\n\n    ctx.strokeStyle = d.stroke;\n    ctx.fillStyle = d.fill;\n\n    ctx.rect(d.x, d.y, d.width, d.height);\n    ctx.closePath();\n    ctx.fill();\n  });\n}\n\nfunction getRenko(props, plotData, xScale, xAccessor, yScale, yAccessor) {\n  const { classNames, fill } = props;\n  const width =\n    xScale(xAccessor(plotData[plotData.length - 1])) -\n    xScale(xAccessor(plotData[0]));\n\n  const candleWidth = width / (plotData.length - 1);\n  const candles = plotData\n    .filter(d => isDefined(yAccessor(d).close))\n    .map(d => {\n      const ohlc = yAccessor(d);\n      const x = xScale(xAccessor(d)) - 0.5 * candleWidth,\n        y = yScale(Math.max(ohlc.open, ohlc.close)),\n        height = Math.abs(yScale(ohlc.open) - yScale(ohlc.close)),\n        className = ohlc.open <= ohlc.close ? classNames.up : classNames.down;\n\n      const svgfill = d.fullyFormed\n        ? ohlc.open <= ohlc.close\n          ? fill.up\n          : fill.down\n        : fill.partial;\n\n      return {\n        className: className,\n        fill: svgfill,\n        x: x,\n        y: y,\n        height: height,\n        width: candleWidth,\n      };\n    });\n  return candles;\n}\n\nexport default RenkoSeries;\n"]}
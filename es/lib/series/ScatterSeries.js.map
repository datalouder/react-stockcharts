{"version":3,"sources":["../../../../src/lib/series/ScatterSeries.js"],"names":["React","Component","PropTypes","nest","d3Nest","GenericChartComponent","getAxisCanvas","hexToRGBA","functor","ScatterSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","xAccessor","points","helper","className","markerProps","map","point","idx","Marker","marker","propTypes","string","yAccessor","func","isRequired","markerProvider","object","defaultProps","xScale","yScale","chartConfig","plotData","Error","d","mProps","fill","stroke","x","y","opacity","datum","key","entries","forEach","fillKey","fillGroup","fillValues","values","fillStyle","strokeValues","strokeGroup"],"mappings":"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","file":"ScatterSeries.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { nest as d3Nest } from 'd3-collection';\n\nimport GenericChartComponent from '../GenericChartComponent';\nimport { getAxisCanvas } from '../GenericComponent';\n\nimport { hexToRGBA, functor } from '../utils';\n\nclass ScatterSeries extends Component {\n  constructor(props) {\n    super(props);\n    this.renderSVG = this.renderSVG.bind(this);\n    this.drawOnCanvas = this.drawOnCanvas.bind(this);\n  }\n  drawOnCanvas(ctx, moreProps) {\n    const { xAccessor } = moreProps;\n\n    const points = helper(this.props, moreProps, xAccessor);\n\n    drawOnCanvas(ctx, this.props, points);\n  }\n  renderSVG(moreProps) {\n    const { className, markerProps } = this.props;\n    const { xAccessor } = moreProps;\n\n    const points = helper(this.props, moreProps, xAccessor);\n\n    return (\n      <g className={className}>\n        {points.map((point, idx) => {\n          const { marker: Marker } = point;\n          return <Marker key={idx} {...markerProps} point={point} />;\n        })}\n      </g>\n    );\n  }\n  render() {\n    return (\n      <GenericChartComponent\n        svgDraw={this.renderSVG}\n        canvasDraw={this.drawOnCanvas}\n        canvasToDraw={getAxisCanvas}\n        drawOn={['pan']}\n      />\n    );\n  }\n}\n\nScatterSeries.propTypes = {\n  className: PropTypes.string,\n  yAccessor: PropTypes.func.isRequired,\n  marker: PropTypes.func,\n  markerProvider: PropTypes.func,\n  markerProps: PropTypes.object,\n};\n\nScatterSeries.defaultProps = {\n  className: 'react-stockcharts-scatter',\n};\n\nfunction helper(props, moreProps, xAccessor) {\n  const { yAccessor, markerProvider, markerProps } = props;\n  let { marker: Marker } = props;\n  const {\n    xScale,\n    chartConfig: { yScale },\n    plotData,\n  } = moreProps;\n\n  if (!(markerProvider || Marker))\n    throw new Error('required prop, either marker or markerProvider missing');\n\n  return plotData.map(d => {\n    if (markerProvider) Marker = markerProvider(d);\n\n    const mProps = { ...Marker.defaultProps, ...markerProps };\n\n    const fill = functor(mProps.fill);\n    const stroke = functor(mProps.stroke);\n\n    return {\n      x: xScale(xAccessor(d)),\n      y: yScale(yAccessor(d)),\n      fill: hexToRGBA(fill(d), mProps.opacity),\n      stroke: stroke(d),\n      datum: d,\n      marker: Marker,\n    };\n  });\n}\n\nfunction drawOnCanvas(ctx, props, points) {\n  const { markerProps } = props;\n\n  const nest = d3Nest()\n    .key(d => d.fill)\n    .key(d => d.stroke)\n    .entries(points);\n\n  nest.forEach(fillGroup => {\n    const { key: fillKey, values: fillValues } = fillGroup;\n\n    if (fillKey !== 'none') {\n      ctx.fillStyle = fillKey;\n    }\n\n    fillValues.forEach(strokeGroup => {\n      // var { key: strokeKey, values: strokeValues } = strokeGroup;\n      const { values: strokeValues } = strokeGroup;\n\n      strokeValues.forEach(point => {\n        const { marker } = point;\n        marker.drawOnCanvas(\n          { ...marker.defaultProps, ...markerProps, fill: fillKey },\n          point,\n          ctx\n        );\n      });\n    });\n  });\n}\n\nexport default ScatterSeries;\n"]}
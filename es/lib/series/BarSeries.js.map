{"version":3,"sources":["../../../../src/lib/series/BarSeries.js"],"names":["React","Component","PropTypes","GenericChartComponent","getAxisCanvas","StackedBarSeries","drawOnCanvasHelper","drawOnCanvas2","getBarsSVG2","svgHelper","identityStack","functor","isDefined","BarSeries","props","renderSVG","bind","drawOnCanvas","ctx","moreProps","swapScales","xAccessor","bars","getBars","clip","propTypes","baseAt","oneOfType","number","func","stroke","bool","width","yAccessor","isRequired","opacity","fill","string","className","defaultProps","xScale","plotData","yScale","chartConfig","getFill","getBase","widthFunctor","offset","Math","floor","filter","d","map","yValue","y","x","round","h","height"],"mappings":"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","file":"BarSeries.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport GenericChartComponent from '../GenericChartComponent';\nimport { getAxisCanvas } from '../GenericComponent';\n\nimport StackedBarSeries, {\n  drawOnCanvasHelper,\n  drawOnCanvas2,\n  getBarsSVG2,\n  svgHelper,\n  identityStack,\n} from './StackedBarSeries';\n\nimport { functor, isDefined } from '../utils';\n\nclass BarSeries extends Component {\n  constructor(props) {\n    super(props);\n    this.renderSVG = this.renderSVG.bind(this);\n    this.drawOnCanvas = this.drawOnCanvas.bind(this);\n  }\n  drawOnCanvas(ctx, moreProps) {\n    if (this.props.swapScales) {\n      const { xAccessor } = moreProps;\n      drawOnCanvasHelper(ctx, this.props, moreProps, xAccessor, identityStack);\n    } else {\n      const bars = getBars(this.props, moreProps);\n      drawOnCanvas2(this.props, ctx, bars);\n    }\n  }\n  renderSVG(moreProps) {\n    if (this.props.swapScales) {\n      const { xAccessor } = moreProps;\n      return (\n        <g>{svgHelper(this.props, moreProps, xAccessor, identityStack)}</g>\n      );\n    } else {\n      const bars = getBars(this.props, moreProps);\n      return <g>{getBarsSVG2(this.props, bars)}</g>;\n    }\n  }\n  render() {\n    const { clip } = this.props;\n\n    return (\n      <GenericChartComponent\n        clip={clip}\n        svgDraw={this.renderSVG}\n        canvasToDraw={getAxisCanvas}\n        canvasDraw={this.drawOnCanvas}\n        drawOn={['pan']}\n      />\n    );\n  }\n}\n\nBarSeries.propTypes = {\n  baseAt: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  stroke: PropTypes.bool,\n  width: PropTypes.oneOfType([PropTypes.number, PropTypes.func]),\n  yAccessor: PropTypes.func.isRequired,\n  opacity: PropTypes.number,\n  fill: PropTypes.oneOfType([PropTypes.func, PropTypes.string]),\n  className: PropTypes.oneOfType([PropTypes.func, PropTypes.string]),\n  clip: PropTypes.bool,\n  swapScales: PropTypes.bool,\n};\n\nBarSeries.defaultProps = StackedBarSeries.defaultProps;\n\nexport default BarSeries;\n\n/*\n Initially, this program was using StackedBarSeries.getBars\n to benefit from code reuse and having a single place that\n contains the logic for drawing all types of bar charts\n simple, grouped, horizontal, but turnes out\n making it highly cuztimizable also made it slow for the\n most simple case, a regular bar chart.\n This function contains just the necessary logic\n to create bars\n*/\nfunction getBars(props, moreProps) {\n  const { baseAt, fill, stroke, yAccessor } = props;\n  const {\n    xScale,\n    xAccessor,\n    plotData,\n    chartConfig: { yScale },\n  } = moreProps;\n\n  const getFill = functor(fill);\n  const getBase = functor(baseAt);\n\n  const widthFunctor = functor(props.width);\n\n  const width = widthFunctor(props, {\n    xScale,\n    xAccessor,\n    plotData,\n  });\n  /*\n\tconst barWidth = Math.round(width);\n\tconst offset = Math.round(barWidth === 1 ? 0 : 0.5 * barWidth);\n\t*/\n  const offset = Math.floor(0.5 * width);\n\n  const bars = plotData\n    .filter(d => isDefined(yAccessor(d)))\n    .map(d => {\n      const yValue = yAccessor(d);\n      let y = yScale(yValue);\n\n      const x = Math.round(xScale(xAccessor(d))) - offset;\n      let h = getBase(xScale, yScale, d) - yScale(yValue);\n\n      if (h < 0) {\n        y = y + h;\n        h = -h;\n      }\n\n      return {\n        // type: \"line\"\n        x,\n        y: Math.round(y),\n        height: Math.round(h),\n        width: offset * 2,\n        fill: getFill(d, 0),\n        stroke: stroke ? getFill(d, 0) : 'none',\n      };\n    });\n\n  return bars;\n}\n"]}
{"version":3,"sources":["../../../../src/lib/series/TriangleMarker.js"],"names":["React","PropTypes","hexToRGBA","functor","Triangle","props","className","strokeWidth","opacity","point","width","rotation","getRotationInDegrees","fillColor","getFillColor","strokeColor","getStrokeColor","w","datum","x","y","getTrianglePoints","innerOpposite","innerHypotenuse","points","propTypes","direction","oneOfType","oneOf","func","isRequired","stroke","string","fill","number","shape","object","defaultProps","drawOnCanvas","ctx","strokeStyle","lineWidth","fillStyle","drawOnCanvasWithNoStateChange","rotationDeg","beginPath","moveTo","lineTo","save","translate","rotate","Math","PI","restore","cos","tan","Function","directionVal"],"mappings":"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","file":"TriangleMarker.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { hexToRGBA, functor } from '../utils';\n\nfunction Triangle(props) {\n  const { className, strokeWidth, opacity, point, width } = props;\n\n  const rotation = getRotationInDegrees(props, point);\n  if (rotation == null) return null;\n\n  const fillColor = getFillColor(props);\n  const strokeColor = getStrokeColor(props);\n\n  const w = functor(width)(point.datum);\n  const { x, y } = point;\n  const { innerOpposite, innerHypotenuse } = getTrianglePoints(w);\n  const points = `\n\t\t${x} ${y - innerHypotenuse},\n\t\t${x + w / 2} ${y + innerOpposite},\n\t\t${x - w / 2} ${y + innerOpposite}\n\t`;\n\n  return (\n    <polygon\n      className={className}\n      points={points}\n      stroke={strokeColor}\n      strokeWidth={strokeWidth}\n      fillOpacity={opacity}\n      fill={fillColor}\n      transform={rotation !== 0 ? `rotate(${rotation}, ${x}, ${y})` : null}\n    />\n  );\n}\nTriangle.propTypes = {\n  direction: PropTypes.oneOfType([\n    PropTypes.oneOf(['top', 'bottom', 'left', 'right', 'hide']),\n    PropTypes.func,\n  ]).isRequired,\n  stroke: PropTypes.oneOfType([PropTypes.string, PropTypes.func]).isRequired,\n  fill: PropTypes.oneOfType([PropTypes.string, PropTypes.func]).isRequired,\n  opacity: PropTypes.number.isRequired,\n  point: PropTypes.shape({\n    x: PropTypes.number.isRequired,\n    y: PropTypes.number.isRequired,\n    datum: PropTypes.object.isRequired,\n  }).isRequired,\n  className: PropTypes.string,\n  strokeWidth: PropTypes.number,\n  width: PropTypes.oneOfType([PropTypes.number, PropTypes.func]).isRequired,\n};\nTriangle.defaultProps = {\n  direction: 'top',\n  stroke: '#4682B4',\n  strokeWidth: 1,\n  opacity: 0.5,\n  fill: '#4682B4',\n  className: 'react-stockcharts-marker-triangle',\n};\nTriangle.drawOnCanvas = (props, point, ctx) => {\n  const { stroke, fill, opacity, strokeWidth } = props;\n  ctx.strokeStyle = stroke;\n  ctx.lineWidth = strokeWidth;\n  if (fill !== 'none') {\n    ctx.fillStyle = hexToRGBA(fill, opacity);\n  }\n  Triangle.drawOnCanvasWithNoStateChange(props, point, ctx);\n};\nTriangle.drawOnCanvasWithNoStateChange = (props, point, ctx) => {\n  const { width } = props;\n  const w = functor(width)(point.datum);\n  const { x, y } = point;\n  const { innerOpposite, innerHypotenuse } = getTrianglePoints(w);\n  const rotationDeg = getRotationInDegrees(props, point);\n\n  ctx.beginPath();\n  ctx.moveTo(x, y - innerHypotenuse);\n  ctx.lineTo(x + w / 2, y + innerOpposite);\n  ctx.lineTo(x - w / 2, y + innerOpposite);\n  ctx.stroke();\n\n  // TODO: rotation does not work\n  // example: https://gist.github.com/geoffb/6392450\n  if (rotationDeg !== null && rotationDeg !== 0) {\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate((rotationDeg * Math.PI) / 180); // 45 degrees\n    ctx.fill();\n    ctx.restore();\n  }\n  ctx.fill();\n};\nexport default Triangle;\n\nfunction getTrianglePoints(width) {\n  const innerHypotenuse = (width / 2) * (1 / Math.cos((30 * Math.PI) / 180));\n  const innerOpposite = (width / 2) * (1 / Math.tan((60 * Math.PI) / 180));\n  return {\n    innerOpposite,\n    innerHypotenuse,\n  };\n}\n\nfunction getFillColor(props) {\n  const { fill, point } = props;\n  return fill instanceof Function ? fill(point.datum) : fill;\n}\n\nfunction getStrokeColor(props) {\n  const { stroke, point } = props;\n  return stroke instanceof Function ? stroke(point.datum) : stroke;\n}\n\nfunction getRotationInDegrees(props, point) {\n  const { direction } = props;\n  const directionVal =\n    direction instanceof Function ? direction(point.datum) : direction;\n  if (directionVal === 'hide') return null;\n\n  let rotate = 0;\n  switch (directionVal) {\n    case 'bottom':\n      rotate = 180;\n      break;\n    case 'left':\n      rotate = -90;\n      break;\n    case 'right':\n      rotate = 90;\n      break;\n  }\n  return rotate;\n}\n"]}
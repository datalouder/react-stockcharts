{"version":3,"sources":["../../../../../src/lib/interactive/wrapper/EachText.js"],"names":["React","Component","PropTypes","noop","saveNodeType","isHover","getXValue","HoverTextNearMouse","InteractiveText","EachText","props","handleHover","bind","handleDragStart","handleDrag","nodes","state","hover","moreProps","position","mouseXY","yScale","chartConfig","xScale","mouseX","mouseY","textCX","textCY","dx","dy","dragStartPosition","index","onDrag","xAccessor","plotData","xValue","invert","xyValue","hovering","setState","bgFill","bgOpacity","bgStroke","bgStrokeWidth","textFill","fontFamily","fontSize","fontWeight","fontStyle","text","hoverText","selected","onDragComplete","hoverHandler","onHover","onUnHover","hoverTextEnabled","enable","hoverTextSelected","selectedText","hoverTextUnselected","restHoverTextProps","propTypes","number","array","isRequired","string","bool","func","object","defaultProps","fill","bgHeight","bgWidth"],"mappings":"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","file":"EachText.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport { noop } from '../../utils';\nimport { saveNodeType, isHover } from '../utils';\nimport { getXValue } from '../../utils/ChartDataUtil';\n\nimport HoverTextNearMouse from '../components/HoverTextNearMouse';\nimport InteractiveText from '../components/InteractiveText';\n\nclass EachText extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleHover = this.handleHover.bind(this);\n\n    this.handleDragStart = this.handleDragStart.bind(this);\n    this.handleDrag = this.handleDrag.bind(this);\n\n    this.isHover = isHover.bind(this);\n    this.saveNodeType = saveNodeType.bind(this);\n    this.nodes = {};\n\n    this.state = {\n      hover: false,\n    };\n  }\n  handleDragStart(moreProps) {\n    const { position } = this.props;\n    const { mouseXY } = moreProps;\n    const {\n      chartConfig: { yScale },\n      xScale,\n    } = moreProps;\n    const [mouseX, mouseY] = mouseXY;\n\n    const [textCX, textCY] = position;\n    const dx = mouseX - xScale(textCX);\n    const dy = mouseY - yScale(textCY);\n\n    this.dragStartPosition = {\n      position,\n      dx,\n      dy,\n    };\n  }\n  handleDrag(moreProps) {\n    const { index, onDrag } = this.props;\n    const {\n      mouseXY: [, mouseY],\n      chartConfig: { yScale },\n      xAccessor,\n      mouseXY,\n      plotData,\n      xScale,\n    } = moreProps;\n\n    const { dx, dy } = this.dragStartPosition;\n    const xValue = xScale.invert(\n      xScale(getXValue(xScale, xAccessor, mouseXY, plotData)) - dx\n    );\n    // xScale.invert(xScale(xAccessor(currentItem)) - dx);\n    const xyValue = [xValue, yScale.invert(mouseY - dy)];\n\n    onDrag(index, xyValue);\n  }\n  handleHover(moreProps) {\n    if (this.state.hover !== moreProps.hovering) {\n      this.setState({\n        hover: moreProps.hovering,\n      });\n    }\n  }\n  render() {\n    const {\n      position,\n      bgFill,\n      bgOpacity,\n      bgStroke,\n      bgStrokeWidth,\n      textFill,\n      fontFamily,\n      fontSize,\n      fontWeight,\n      fontStyle,\n      text,\n      hoverText,\n      selected,\n      onDragComplete,\n    } = this.props;\n    const { hover } = this.state;\n\n    const hoverHandler = {\n      onHover: this.handleHover,\n      onUnHover: this.handleHover,\n    };\n\n    const {\n      enable: hoverTextEnabled,\n      selectedText: hoverTextSelected,\n      text: hoverTextUnselected,\n      ...restHoverTextProps\n    } = hoverText;\n\n    return (\n      <g>\n        <InteractiveText\n          ref={this.saveNodeType('text')}\n          selected={selected || hover}\n          interactiveCursorClass=\"react-stockcharts-move-cursor\"\n          {...hoverHandler}\n          onDragStart={this.handleDragStart}\n          onDrag={this.handleDrag}\n          onDragComplete={onDragComplete}\n          position={position}\n          bgFill={bgFill}\n          bgOpacity={bgOpacity}\n          bgStroke={bgStroke || textFill}\n          bgStrokeWidth={bgStrokeWidth}\n          textFill={textFill}\n          fontFamily={fontFamily}\n          fontStyle={fontStyle}\n          fontWeight={fontWeight}\n          fontSize={fontSize}\n          text={text}\n        />\n        <HoverTextNearMouse\n          show={hoverTextEnabled && hover}\n          {...restHoverTextProps}\n          text={selected ? hoverTextSelected : hoverTextUnselected}\n        />\n      </g>\n    );\n  }\n}\n/*\nexport function getNewXY(moreProps, snapTo) {\n\tconst { xScale, xAccessor, plotData, mouseXY } = moreProps;\n\n\tconst currentItem = getCurrentItem(xScale, xAccessor, mouseXY, plotData);\n\tconst x = xAccessor(currentItem);\n\tconst y = snapTo(currentItem);\n\n\treturn [x, y];\n}\n */\nEachText.propTypes = {\n  index: PropTypes.number,\n\n  position: PropTypes.array.isRequired,\n  bgFill: PropTypes.string.isRequired,\n  bgOpacity: PropTypes.number.isRequired,\n  bgStrokeWidth: PropTypes.number.isRequired,\n  bgStroke: PropTypes.string,\n  textFill: PropTypes.string.isRequired,\n\n  fontWeight: PropTypes.string.isRequired,\n  fontFamily: PropTypes.string.isRequired,\n  fontStyle: PropTypes.string.isRequired,\n  fontSize: PropTypes.number.isRequired,\n\n  text: PropTypes.string.isRequired,\n  selected: PropTypes.bool.isRequired,\n\n  onDrag: PropTypes.func.isRequired,\n  onDragComplete: PropTypes.func.isRequired,\n\n  hoverText: PropTypes.object.isRequired,\n};\n\nEachText.defaultProps = {\n  onDrag: noop,\n  onDragComplete: noop,\n  bgOpacity: 1,\n  bgStrokeWidth: 1,\n  selected: false,\n  fill: '#8AAFE2',\n  hoverText: {\n    ...HoverTextNearMouse.defaultProps,\n    enable: true,\n    bgHeight: 'auto',\n    bgWidth: 'auto',\n    text: 'Click to select object',\n  },\n};\n\nexport default EachText;\n"]}